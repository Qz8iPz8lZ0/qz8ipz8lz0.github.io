<!DOCTYPE html> 
<html style class>
<head>
<meta charset=utf-8>
<title>总题：结晶读经纲要　历代志、以斯拉记、尼希米记、以斯帖记|第十一篇　以斯拉之职事与尼希米之领导的内在意义—活出并作出新耶路撒冷，以建造召会作神的家与神的国&lt;/p&gt;</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<style>body{background-color:#E0E0E0}p{padding-left:2em;margin:10px 0}p:first-letter{margin-left:-2em}.AA2{color:#008000;text-align:center;font-weight:bolder;font-size:1.3em}.AA4{font-size:1em;padding-left:2em;color:#000}.CC1{color:#000000;font-weight:bolder;font-size:1.5em}.CC2{color:#000000;padding-left:2.5em;font-weight:bolder;font-size:1.45em}.CC3{color:#000000;padding-left:3em;font-size:1.4em}.CC4{color:#000000;padding-left:3.5em;font-size:1.38em}</style>
<meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:;">
<style>img[src="data:,"],source[src="data:,"]{display:none!important}</style>
</head>
<body>
<p class=AA2>总题：结晶读经纲要　历代志、以斯拉记、尼希米记、以斯帖记</p>
<p class=AA2>第十一篇　以斯拉之职事与尼希米之领导的内在意义—活出并作出新耶路撒冷，以建造召会作神的家与神的国</p>
<p class=AA4>读经：启二一2、9~11、18，二二1</p>
<p class=CC1>壹　以斯拉之<span class>职事的内在意义</span>，具体可见于“洁净”、“教育”与“重构”这三辞；尼希米之领导的内在意义，具体可见于“分别”、“保护”和“彰显”这三辞；我们必须与主天上的职事合作，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=1>按照这内在的意义，活出并作出新耶路撒冷</span>，以建造召会作神的家与神的国—王上八48，诗四八1~2，提前三15，弗二21~22。</p>
<p class=CC1>贰　<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=3>照</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=2>着</span>时代职事里的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=4>时代异象生活并事奉神</span>，乃是活出并作出新耶路撒冷：“墙是用碧玉造的，城是纯金的，如同明净的玻璃”—启二一18，徒二六19，二二15，启二一2、9~11：</p>
<p class=CC2>一　城是纯金的，如同明净的玻璃，表征我们需要<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=5>被神的圣别性情所“洁净”</span>，并且借着“教育”得着光照，就是将圣经教训应用到我们的心思里，使我们的心思得着更新和光照，而清楚神的思想、考虑和法则—参太五8，弗四23，约十七17。</p>
<p class=CC2>二　“建造的工”〔“墙是用碧玉造的”（启二一18）也可译为“<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=6>墙建造的工是用碧玉</span>”—译注〕乃是神唯一的工作，用三一神“重构”我们，使我们以祂为材料而被重建，并将祂供应到人里面，使祂得以将祂自己建造到他们里面，将他们作成新耶路撒冷里的人—林前三9、12，弗三16~19，启三12，歌六4，来十一10。</p>
<p class=CC2>三　城连同城墙，表征新耶路撒冷作为在神元首权柄之下神永远的国，为着“<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=7>分别</span>”神的子民，并“<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=8>保护</span>”神的权益—尼四17，弗五26。</p>
<p class=CC2>四　城墙是碧玉（神生命的丰盛），城是金（神的神圣性情），这启示神永远的经纶乃是使我们在<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=9>生命和性情</span>上，但不在神格上，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=10>与祂一样</span>，作祂唯一的“彰显”—创一26，约十10下，彼后一4，启四3，二一10~11、18。</p>
<p class=CC1>叁　活出并作出新耶路撒冷，就是在以斯拉之职事与尼希米之<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=11>领导的内在意义里生活并事奉</span>：</p>
<p class=CC2>一　我们需要留在<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=12>得洁净</span>的过程里，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=13>脱离一切的搀杂</span>，以主和祂永远经纶的权益为我们唯一的目标—拉九2，太五8，提前三9，林后六4上、6、8中，路九54~55，来四12，王上八48：</p>
<p class=CC3>1  　我们能得洁净，是借<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=14>着神光照</span>、暴露和审判的过程，借着<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=15>十字架的了结</span>和除去，借着<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=16>血的洗净</span>和洗涤，并借着<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=17>那灵的涌流</span>和浸透—诗一三九23~24，五一7、10，启二二1。</p>
<p class=CC3>2  　我们能得洁净，是借着神纯净的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=18>话里生命之水的洗涤</span>过程；一个越在神话语里的人，就越纯净—诗十二6，一一九9、140，弗五26，赛五五8~11。</p>
<p class=CC3>3  　利未记十九章十九节启示，神要一切都<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=19>各从其类</span>，没有任何搀杂—启十七3~6，申二二5、9~11，参创一11、21、24~26，二7~9：</p>
<p class=CC4>a　  牲畜交配不可搀杂，表征<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=23>生命不可搀杂</span>：凡<span class>凭</span><span class>神</span><span class>生命</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=22>而活</span>的，就不可凭肉体而活—参加五16。</p>
<p class=CC4>b　  播种不可搀杂，表征<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=24>话语的职事</span>只该撒播一样的种子，传讲<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=25>一样的教训</span>—神永远经纶独一的教训—申二二9，提前一3~4，六3。</p>
<p class=CC4>c　  不用搀杂的衣料作衣服，表征我们的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=26>行为不可搀杂</span>；活在新约生命里的人，不该凭旧约的规条而活（加二19~20，五1~6）；属于主的人，不该照着外邦人的风俗生活（利二十23，十八3，参弗四17，罗十二2上）。</p>
<p class=CC3>4  　彼前一章二十二节说，“你们既因顺从真理，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=27>洁净了自己的魂</span>，以致爱弟兄没有假冒，就当从清洁的心里彼此热切相爱”：</p>
<p class=CC4>a　  我们的魂（我们的心思、情感和意志）得洁净，是指我们的魂从神以外的各样事物中蒙拯救，而固定在神这唯一的对象和独一的目标上（林前二9~10，帖后三5）；当我们顺从真理，就是顺从我们在基督里之信仰的内容和实际时（提后四7，多一1），我们的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=28>全魂就专注于神</span>，因而得着洁净，脱离神以外的一切事物。</p>
<p class=CC4>b　  我们的魂既得着洁净，全人专注于神，使我们的全心、全魂并<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=29>全心思都爱祂</span>（可十二30），结果就是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=30>爱弟兄没有假冒</span>，从心里热切地爱神所爱的人（约十三5、14~17、34~35，彼后一5、7，罗十二9~11，提后一6~7，帖前三12，四9~10，来十三1，约壹二5~8，三11、23，四7~8、16~21）。</p>
<p class=CC2>二　我们需要<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=31>受教育</span>，好用真理<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=32>教育别人</span>，使神得着见证，就是祂团体的彰显—提后二2，提前三15~16，六3，林前十四31：</p>
<p class=CC3>1  　圣城新耶路撒冷的十二根基有羔羊十二使徒的名字，指明新耶路撒冷的建造乃是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=33>按照使徒的教训</span>，就是神经纶健康的教训—启二一14，徒二42，提后一15，多一9，提后二2。</p>
<p class=CC3>2  　以斯拉<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=34>精通</span>神的律法，这律法乃是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=35>联于神的经纶</span>；律法预表基督是神的话、神的见证、神的描绘、神的彰显—出十六34，三四28，参启一2。</p>
<p class=CC3>3  　我们在写成的话里来到基督这活的话跟前，祂就能成为应用的话，使我们被祂注入，而<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=36>成为耶稣的见证</span>—约一1，启十九13，约五39~40，六63，启一2、10~11。</p>
<p class=CC3>4  　我们留于神经纶教训的唯一职事里，就能<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=37>领略主话的内在意义</span>，而被生命的光所充满—尼八8、13，太四12~16，约一4~5。</p>
<p class=CC3>5  　我们必须<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=38>学习使用新文化</span>（就是新人的神人文化）里的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=39>新语言</span>，就是“犹大的话”—尼十三23~24。</p>
<p class=CC2>三　我们需要<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=40>被恩典重新构成</span>，这恩典就是经过过程的三一神，成为我们的生命和一切—彼前五10，林后十三14，来十29：</p>
<p class=CC3>1  　十二使徒代表新约的恩典，表征<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=41>恩典是</span>产生新耶路撒冷的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=42>源头</span>、元素和凭借—启二一14。</p>
<p class=CC3>2  　我们需要<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=43>被恩典加上恩典</span>所构成，凭恩典劳苦，分赐恩典，并供应恩典的话—约一16，林前十五10，彼前四10，徒二十32。</p>
<p class=CC3>3  　新耶路撒冷是由神将祂自己构成到人里面，使人在生命和性情上，但不在神格上成为神，而建造成的，使<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=44>神与人成为团体的实体</span>，和相互的居所—启二一2~3、10~11、18~22。</p>
<p class=CC3>4  　我们只该作一个工作，就是新耶路撒冷的工作；当我们内里运行的神在往前<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=45>带领祂所拣选的人经过祂生机救恩</span>的主要步骤，就是重生、圣别、更新、变化、模成以致荣化时，我们必须与祂是一。</p>
<p class=CC3>5  　这样一层一层地爬上去，爬到最高点，就是大家都一致了，都没有肉体了，没有天然了，都是在灵里，都是新耶路撒冷里的人；这个就是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=46>神工作的最高点</span>，而我们乃是祂的同工—约五17，腓二13，启四3，二一11，林前三9、12，林后六1，帖前三2。</p>
<p class=CC3>6  　“经过过程并终极完成的三一神，照着祂的心爱美意，并为着<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=47>祂经纶中的最高目的</span>，正将祂自己建造到祂所拣选的人里面，并将祂所拣选的人建造到祂自己里面，使祂得着在基督里神人二性相调的构成体，作祂的生机体和基督的身体，成为祂永远的彰显，以及救赎之神与蒙救赎之人相互的住处。这奇妙珍宝结构的终极完成，将是新耶路撒冷，直到永远”—李常受。</p>
<p class=CC2>四　我们需要<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=48>完全分别</span>出来归给神，被神全然浸透，为着召会生活过圣别的生活，使我们<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=49>成为圣城</span>—启二一2，彼后一4：</p>
<p class=CC3>1  　心思的更新及其结果—变化，将我们从我们那<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=50>被世界元素泡透的性情和生活分别出来</span>，并拯救我们脱离这样的性情和生活—启二一12上，罗八5~6，十二2、5~11，弗四23。</p>
<p class=CC3>2  　我们借着活<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=51>在灵中并吃基督作隐藏的吗哪</span>，就能胜过世界而成为神的建造—约壹五4、18~19、21，启二12~17，参约十四30。</p>
<p class=CC3>3  　我们需要完全从<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=52>巴比伦的偶像世界</span>分别出来；巴比伦的偶像世界是以买卖或商业的邪恶为特征，牵涉到<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=54>贪</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=53>婪、诡诈和贪财</span>；我们的基督徒生活不该贪财，我们的基督徒工作不该是赚钱的行业—亚五5~11，提前三3、8，六5~10，徒十一29~30，二十33~34，提后三2~4，来十三5，林后二17，十二15，参王下五15~27：</p>
<p class=CC4>a　  撒但是生意人，商人，他的思想是照着他的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=55>商业原则</span>，与神创造人的定旨相对—结二八16、18，伯一9，参腓三7~8，创一26。</p>
<p class=CC4>b　  巴比伦所<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=56>贩卖的货物</span>，头一项是金，末一项是人口；“人口〔直译，人的魂〕”就是为了被雇用而贩卖自己的人—启十八12~13，参彼后二3、15。</p>
<p class=CC4>c　  这不仅描述要来的巴比伦，也描述今天的世界；人把自己的魂、自己的生命（就是他们自己）<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=57>卖给职</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=58>业</span>，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=59>忽视了神</span>和他们永远的定命—参路十二13~21。</p>
<p class=CC4>d　  神主宰的权柄，要把以色列人在被掳时从巴比伦人所学商业中的罪恶，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=60>归还巴比伦</span>（示拿地）—亚五10~11，创十一2、9。</p>
<p class=CC2>五　我们需要建造城墙，以<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=61>保护召会作神的家</span>：</p>
<p class=CC3>1  　我们能<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=62>凭羔羊得胜的血</span>建造城墙，这血借着我们悔改、认罪并求神洁净，而应用在我们身上—启十二11，诗五一18。</p>
<p class=CC3>2  　我们必须<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=63>牧养神的群羊</span>，就是要吹独一新约职事的一个号声，将神一切的旨意告诉神的群羊，以主保护的警戒和健康的教训，完成神的话，使群羊得以在基督里长大成熟—林前十四8，弗四11，徒二十26~35，结三三1~11，三四25，西一24~29。</p>
<p class=CC3>3  　我们必须<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=64>在身体里争战</span>，好建造城墙以保护召会—罗十六20：</p>
<p class=CC4>a　  身体穿上神的全副军装，而对每一个肢体给与保护；我们必须寻求身体的意见和覆庇，好<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=65>得着身体的保障与护卫</span>—弗六10~20，太十六18，徒二一4、11~12。</p>
<p class=CC4>b　  属灵争战是按着这个原则：一人追赶千人，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=66>二人使万人逃跑</span>—申三二30，传四9~12，出十七11~13。</p>
<p class=CC3>4  　我们必须建造城墙，以<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=67>保护神</span>的神性丰富<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=68>在地上的权益</span>，以及祂终极的成就—参约一12~13，赛九6，林前十五45下，林后三17，四5，西一18，徒二36，五31，来四14，九15，七22，八2，约壹二1，约十五26，罗八34、26。</p>
<p class=CC2>六　我们需要凭基督而活，并<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=69>活出基督</span>，因而显大基督，好使我们能建造召会<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=70>作神的彰显</span>—出四十34~35，王上八1~11，罗十三14、12，林前三16~17，腓一19~21上，启二一3、22、10~11：</p>
<p class=CC3>1  　城墙是为着神的彰显；因此，建造城墙（尼二17）就是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=71>建造召会作神的彰显</span>（太十六18，弗二20~22，四11~16，林前三9~17，启四3，二一11、18~19）。</p>
<p class=CC3>2  　今天主在祂的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=73>恢复</span>里正在作工，要恢复正常的光景，就是基督<span class>在<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=74>作祂彰显的正确召会</span></span>里—弗三16~21，启四3，二一11、18~19。</p>
<p class=CC3>3  　我们要彰显神，就需要借着在基督<span class>全身体的相调生活里</span>，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=75>过与神圣三一调和的生活</span>，蒙拯救脱离我们天然的个性和己的样式—罗五10，利二4~5，林前十二24~25。</p>
<p class=CC3>4  　我们要彰显神，就需要天天借着话中之水的洗涤，被圣化并得更新，好献给我们的新郎基督，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=76>作祂纯洁、荣耀、彰显神的新妇</span>—24节，弗五26~27。</p>
<p class=CC1>真理启示：</p>
<p class=CC3>1  　以斯拉之职事的内在意义，具体可见于“洁净”、“教育”与“重构”这三辞；尼希米之领导的内在意义，具体可见于“分别”、“保护”和“彰显”这三辞；我们必须与主天上的职事合作，按照这内在的意义，活出并作出新耶路撒冷，以建造召会作神的家与神的国。</p>
<p class=CC3>2  　“建造的工”乃是神唯一的工作，用三一神“重构”我们，使我们以祂为材料而被重建，并将祂供应到人里面，使祂得以将祂自己建造到他们里面，将他们作成新耶路撒冷里的人。</p>
<p class=CC1>生命经历：</p>
<p class=CC3>1  　我们能得洁净，是借着神光照、暴露和审判的过程，借着十字架的了结和除去，借着血的洗净和洗涤，并借着那灵的涌流和浸透。</p>
<p class=CC3>2  　我们需要被恩典重新构成，这恩典就是经过过程的三一神，成为我们的生命和一切，我们需要被恩典加上恩典所构成，凭恩典劳苦，分赐恩典，并供应恩典的话。</p>
<p class=CC1>实行应用：</p>
<p class=CC3>1  　全心、全魂并全心思都爱神，爱弟兄没有假冒，从心里热切地爱神所爱的人。</p>
<p class=CC3>2  　受教育，并讲说新文化新语言；牧养神的群羊，将神一切的旨意告诉神的群羊。</p>
<p class=CC3>3  　完全从巴比伦的偶像世界分别出来；脱离贪婪、诡诈和贪财；我们的基督徒生活不该贪财</p>
<style>.single-file-highlight-yellow, .single-file-highlight-yellow-mode ::selection { background-color: #ffff7c !important; color: black !important; } .single-file-highlight-pink, .single-file-highlight-pink-mode ::selection { background-color: #ffbbb6 !important; color: black !important; } .single-file-highlight-blue, .single-file-highlight-blue-mode ::selection { background-color: #95d0ff !important; color: black !important; } .single-file-highlight-green, .single-file-highlight-green-mode ::selection { background-color: #93ef8d !important; color: black !important; } span.single-file-highlight-yellow, span.single-file-highlight-pink, span.single-file-highlight-blue, span.single-file-highlight-green { display: inline !important; } .single-file-highlight-hidden { background-color: inherit !important; color: inherit !important; } .single-file-mask { all: initial; display: contents !important; } .single-file-mask.single-file-page-mask { opacity: .99 !important; } single-file-note { all: initial !important; display: contents !important; } .single-file-cut-hover, .single-file-cut-outer-hover, .single-file-cut-selected, .single-file-cut-outer-selected { transition: outline-width 125ms !important; outline-offset: -4px !important; outline-width: 4px !important; } .single-file-cut-hover, .single-file-cut-outer-hover { outline-style: dotted !important; } .single-file-cut-selected, .single-file-cut-outer-selected { outline-style: dashed !important; } .single-file-cut-hover, .single-file-cut-selected { outline-color: red !important; } .single-file-cut-outer-hover, .single-file-cut-outer-selected { outline-color: green !important; } .single-file-cut-mode, .single-file-cut-mode * { pointer-events: auto !important; touch-action: none !important; } .single-file-cut-hover, .single-file-cut-outer-hover, .single-file-remove-highlights-mode .single-file-highlight:hover { cursor: crosshair !important; } .single-file-removed { display: none !important; float: none !important; position: static !important; visibility: collapse !important; } a[href], img { -webkit-touch-callout: none; }</style><script data-template-shadow-root>(() => { document.currentScript.remove(); const processNode = node => { node.querySelectorAll("template[shadowroot]").forEach(element=>{ let shadowRoot = getShadowRoot(element.parentElement); if (!shadowRoot) { try { shadowRoot = element.parentElement.attachShadow({mode:element.getAttribute("shadowroot")}); shadowRoot.innerHTML = element.innerHTML; element.remove(); } catch (error) {} if (shadowRoot) { processNode(shadowRoot); } } }) }; const FORBIDDEN_TAG_NAMES = ["a","area","audio","base","br","col","command","embed","hr","img","iframe","input","keygen","link","meta","param","source","track","video","wbr"]; const NOTE_TAGNAME = "single-file-note"; const NOTE_CLASS = "note"; const NOTE_ANCHORED_CLASS = "note-anchored"; const NOTE_SELECTED_CLASS = "note-selected"; const NOTE_MOVING_CLASS = "note-moving"; const NOTE_MASK_MOVING_CLASS = "note-mask-moving"; const MASK_CLASS = "single-file-mask"; const HIGHLIGHT_CLASS = "single-file-highlight"; const NOTES_WEB_STYLESHEET = ".note { all: initial; display: flex; flex-direction: column; height: 150px; width: 150px; position: absolute; top: 10px; left: 10px; border: 1px solid rgb(191, 191, 191); z-index: 2147483646; box-shadow: 3px 3px 3px rgba(33, 33, 33, .7); min-height: 100px; min-width: 100px; } .note-selected { z-index: 2147483647; } .note-hidden { display: none; } .note-collapsed { min-height: 30px; max-height: 30px; overflow: hidden; } .note blockquote { all: initial; padding: 1px; height: 100%; } .note textarea { all: initial; white-space: break-spaces; font-family: Arial, Helvetica, sans-serif; font-size: 14px; height: 100%; width: 100%; padding: 2px; border: 1px solid transparent; resize: none; color: black; } .note textarea:focus { border: 1px dotted rgb(160, 160, 160); } .note header { all: initial; min-height: 30px; cursor: grab; user-select: none; } .note .note-remove { all: initial; position: absolute; right: 0px; top: 2px; padding: 5px; opacity: .5; cursor: pointer; user-select: none; width: 16px; height: 16px; } .note .note-anchor { all: initial; position: absolute; left: 0px; top: 2px; padding: 5px; opacity: .25; cursor: pointer; width: 16px; height: 16px; } .note .note-resize { all: initial; position: absolute; bottom: -5px; right: -5px; height: 15px; width: 15px; cursor: nwse-resize; user-select: none; } .note .note-remove:hover { opacity: 1; } .note .note-anchor:hover { opacity: .5; } .note-anchored .note-anchor { opacity: .5; } .note-anchored .note-anchor:hover { opacity: 1; } .note-moving { opacity: .75; box-shadow: 6px 6px 3px rgba(33, 33, 33, .7); } .note-moving * { cursor: grabbing; } .note-yellow header { background-color: #f5f545; } .note-yellow blockquote { background-color: #ffff7c; } .note-pink header { background-color: #ffa59f; } .note-pink blockquote { background-color: #ffbbb6; } .note-blue header { background-color: #84c8ff; } .note-blue blockquote { background-color: #95d0ff; } .note-green header { background-color: #93ef8d; } .note-green blockquote { background-color: #9cff95; }"; const MASK_WEB_STYLESHEET = ".note-mask { all: initial; position: fixed; z-index: 2147483645; pointer-events: none; background-color: transparent; transition: background-color 125ms; } .note-mask-moving.note-yellow { background-color: rgba(255, 255, 124, .3); } .note-mask-moving.note-pink { background-color: rgba(255, 187, 182, .3); } .note-mask-moving.note-blue { background-color: rgba(149, 208, 255, .3); } .note-mask-moving.note-green { background-color: rgba(156, 255, 149, .3); } .page-mask { all: initial; position: fixed; top: 0; left: 0; width: 0; height: 0; z-index: 2147483646; } .page-mask-active { width: 100vw; height: 100vh; }"; const NOTE_HEADER_HEIGHT = 25; const PAGE_MASK_ACTIVE_CLASS = "page-mask-active"; const REMOVED_CONTENT_CLASS = "single-file-removed"; const reflowNotes = function reflowNotes() { document.querySelectorAll(NOTE_TAGNAME).forEach(containerElement => { const noteElement = containerElement.shadowRoot.querySelector("." + NOTE_CLASS); const noteBoundingRect = noteElement.getBoundingClientRect(); const anchorElement = getAnchorElement(containerElement); const anchorBoundingRect = anchorElement.getBoundingClientRect(); const maxX = anchorBoundingRect.x + Math.max(0, anchorBoundingRect.width - noteBoundingRect.width); const minX = anchorBoundingRect.x; const maxY = anchorBoundingRect.y + Math.max(0, anchorBoundingRect.height - NOTE_HEADER_HEIGHT); const minY = anchorBoundingRect.y; let left = parseInt(noteElement.style.getPropertyValue("left")); let top = parseInt(noteElement.style.getPropertyValue("top")); if (noteBoundingRect.x > maxX) { left -= noteBoundingRect.x - maxX; } if (noteBoundingRect.x < minX) { left += minX - noteBoundingRect.x; } if (noteBoundingRect.y > maxY) { top -= noteBoundingRect.y - maxY; } if (noteBoundingRect.y < minY) { top += minY - noteBoundingRect.y; } noteElement.style.setProperty("position", "absolute"); noteElement.style.setProperty("left", left + "px"); noteElement.style.setProperty("top", top + "px"); }); }; const addNoteRef = function addNoteRef(anchorElement, noteId) { const noteRefs = getNoteRefs(anchorElement); noteRefs.push(noteId); setNoteRefs(anchorElement, noteRefs); }; const deleteNoteRef = function deleteNoteRef(containerElement, noteId) { const anchorElement = getAnchorElement(containerElement); const noteRefs = getNoteRefs(anchorElement).filter(noteRefs => noteRefs != noteId); if (noteRefs.length) { setNoteRefs(anchorElement, noteRefs); } else { delete anchorElement.dataset.singleFileNoteRefs; } }; const getNoteRefs = function getNoteRefs(anchorElement) { return anchorElement.dataset.singleFileNoteRefs ? anchorElement.dataset.singleFileNoteRefs.split(" ") : []; }; const setNoteRefs = function setNoteRefs(anchorElement, noteRefs) { anchorElement.dataset.singleFileNoteRefs = noteRefs.join(" "); }; const getAnchorElement = function getAnchorElement(containerElement) { return document.querySelector("[data-single-file-note-refs~=\"" + containerElement.dataset.noteId + "\"]") || document.documentElement; }; const getMaskElement = function getMaskElement(className, containerClassName) { let maskElement = document.documentElement.querySelector("." + className); if (!maskElement) { maskElement = document.createElement("div"); const maskContainerElement = document.createElement("div"); if (containerClassName) { maskContainerElement.classList.add(containerClassName); } maskContainerElement.classList.add(MASK_CLASS); const firstNote = document.querySelector(NOTE_TAGNAME); if (firstNote && firstNote.parentElement == document.documentElement) { document.documentElement.insertBefore(maskContainerElement, firstNote); } else { document.documentElement.appendChild(maskContainerElement); } maskElement.classList.add(className); const maskShadow = maskContainerElement.attachShadow({ mode: "open" }); maskShadow.appendChild(getStyleElement(MASK_WEB_STYLESHEET)); maskShadow.appendChild(maskElement); return maskElement; } }; const getStyleElement = function getStyleElement(stylesheet) { const linkElement = document.createElement("style"); linkElement.textContent = stylesheet; return linkElement; }; const attachNoteListeners = function attachNoteListeners(containerElement, editable = false) { const SELECT_PX_THRESHOLD = 4; const COLLAPSING_NOTE_DELAY = 750; const noteShadow = containerElement.shadowRoot; const noteElement = noteShadow.childNodes[1]; const headerElement = noteShadow.querySelector("header"); const mainElement = noteShadow.querySelector("textarea"); const noteId = containerElement.dataset.noteId; const resizeElement = noteShadow.querySelector(".note-resize"); const anchorIconElement = noteShadow.querySelector(".note-anchor"); const removeNoteElement = noteShadow.querySelector(".note-remove"); mainElement.readOnly = !editable; if (!editable) { anchorIconElement.style.setProperty("display", "none", "important"); } else { anchorIconElement.style.removeProperty("display"); } headerElement.ontouchstart = headerElement.onmousedown = event => { if (event.target == headerElement) { collapseNoteTimeout = setTimeout(() => { noteElement.classList.toggle("note-collapsed"); hideMaskNote(); }, COLLAPSING_NOTE_DELAY); event.preventDefault(); const position = getPosition(event); const clientX = position.clientX; const clientY = position.clientY; const boundingRect = noteElement.getBoundingClientRect(); const deltaX = clientX - boundingRect.left; const deltaY = clientY - boundingRect.top; maskPageElement.classList.add(PAGE_MASK_ACTIVE_CLASS); document.documentElement.style.setProperty("user-select", "none", "important"); anchorElement = getAnchorElement(containerElement); displayMaskNote(); selectNote(noteElement); moveNote(event, deltaX, deltaY); movingNoteMode = { event, deltaX, deltaY }; document.documentElement.ontouchmove = document.documentElement.onmousemove = event => { clearTimeout(collapseNoteTimeout); if (!movingNoteMode) { movingNoteMode = { deltaX, deltaY }; } movingNoteMode.event = event; moveNote(event, deltaX, deltaY); }; } }; resizeElement.ontouchstart = resizeElement.onmousedown = event => { event.preventDefault(); resizingNoteMode = true; selectNote(noteElement); maskPageElement.classList.add(PAGE_MASK_ACTIVE_CLASS); document.documentElement.style.setProperty("user-select", "none", "important"); document.documentElement.ontouchmove = document.documentElement.onmousemove = event => { event.preventDefault(); const { clientX, clientY } = getPosition(event); const boundingRectNote = noteElement.getBoundingClientRect(); noteElement.style.width = clientX - boundingRectNote.left + "px"; noteElement.style.height = clientY - boundingRectNote.top + "px"; }; }; anchorIconElement.ontouchend = anchorIconElement.onclick = event => { event.preventDefault(); noteElement.classList.toggle(NOTE_ANCHORED_CLASS); if (!noteElement.classList.contains(NOTE_ANCHORED_CLASS)) { deleteNoteRef(containerElement, noteId); addNoteRef(document.documentElement, noteId); } onUpdate(false); }; removeNoteElement.ontouchend = removeNoteElement.onclick = event => { event.preventDefault(); deleteNoteRef(containerElement, noteId); containerElement.remove(); }; noteElement.onmousedown = () => { selectNote(noteElement); }; function moveNote(event, deltaX, deltaY) { event.preventDefault(); const { clientX, clientY } = getPosition(event); noteElement.classList.add(NOTE_MOVING_CLASS); if (editable) { if (noteElement.classList.contains(NOTE_ANCHORED_CLASS)) { deleteNoteRef(containerElement, noteId); anchorElement = getTarget(clientX, clientY) || document.documentElement; addNoteRef(anchorElement, noteId); } else { anchorElement = document.documentElement; } } document.documentElement.insertBefore(containerElement, maskPageElement.getRootNode().host); noteElement.style.setProperty("left", (clientX - deltaX) + "px"); noteElement.style.setProperty("top", (clientY - deltaY) + "px"); noteElement.style.setProperty("position", "fixed"); displayMaskNote(); } function displayMaskNote() { if (anchorElement == document.documentElement || anchorElement == document.documentElement) { hideMaskNote(); } else { const boundingRectAnchor = anchorElement.getBoundingClientRect(); maskNoteElement.classList.add(NOTE_MASK_MOVING_CLASS); if (selectedNote) { maskNoteElement.classList.add(selectedNote.dataset.color); } maskNoteElement.style.setProperty("top", (boundingRectAnchor.y - 3) + "px"); maskNoteElement.style.setProperty("left", (boundingRectAnchor.x - 3) + "px"); maskNoteElement.style.setProperty("width", (boundingRectAnchor.width + 3) + "px"); maskNoteElement.style.setProperty("height", (boundingRectAnchor.height + 3) + "px"); } } function hideMaskNote() { maskNoteElement.classList.remove(NOTE_MASK_MOVING_CLASS); if (selectedNote) { maskNoteElement.classList.remove(selectedNote.dataset.color); } } function selectNote(noteElement) { if (selectedNote) { selectedNote.classList.remove(NOTE_SELECTED_CLASS); maskNoteElement.classList.remove(selectedNote.dataset.color); } noteElement.classList.add(NOTE_SELECTED_CLASS); noteElement.classList.add(noteElement.dataset.color); selectedNote = noteElement; } function getTarget(clientX, clientY) { const targets = Array.from(document.elementsFromPoint(clientX, clientY)).filter(element => element.matches("html *:not(" + NOTE_TAGNAME + "):not(." + MASK_CLASS + ")")); if (!targets.includes(document.documentElement)) { targets.push(document.documentElement); } let newTarget, target = targets[0], boundingRect = target.getBoundingClientRect(); newTarget = determineTargetElement("floor", target, clientX - boundingRect.left, getMatchedParents(target, "left")); if (newTarget == target) { newTarget = determineTargetElement("ceil", target, boundingRect.left + boundingRect.width - clientX, getMatchedParents(target, "right")); } if (newTarget == target) { newTarget = determineTargetElement("floor", target, clientY - boundingRect.top, getMatchedParents(target, "top")); } if (newTarget == target) { newTarget = determineTargetElement("ceil", target, boundingRect.top + boundingRect.height - clientY, getMatchedParents(target, "bottom")); } target = newTarget; while (boundingRect = target && target.getBoundingClientRect(), boundingRect && boundingRect.width <= SELECT_PX_THRESHOLD && boundingRect.height <= SELECT_PX_THRESHOLD) { target = target.parentElement; } return target; } function getMatchedParents(target, property) { let element = target, matchedParent, parents = []; do { const boundingRect = element.getBoundingClientRect(); if (element.parentElement && !element.parentElement.tagName.toLowerCase() != NOTE_TAGNAME && !element.classList.contains(MASK_CLASS)) { const parentBoundingRect = element.parentElement.getBoundingClientRect(); matchedParent = Math.abs(parentBoundingRect[property] - boundingRect[property]) <= SELECT_PX_THRESHOLD; if (matchedParent) { if (element.parentElement.clientWidth > SELECT_PX_THRESHOLD && element.parentElement.clientHeight > SELECT_PX_THRESHOLD && ((element.parentElement.clientWidth - element.clientWidth > SELECT_PX_THRESHOLD) || (element.parentElement.clientHeight - element.clientHeight > SELECT_PX_THRESHOLD))) { parents.push(element.parentElement); } element = element.parentElement; } } else { matchedParent = false; } } while (matchedParent && element); return parents; } function determineTargetElement(roundingMethod, target, widthDistance, parents) { if (Math[roundingMethod](widthDistance / SELECT_PX_THRESHOLD) <= parents.length) { target = parents[parents.length - Math[roundingMethod](widthDistance / SELECT_PX_THRESHOLD) - 1]; } return target; } }; const anchorNote = function anchorNote(event, noteElement, deltaX, deltaY) { event.preventDefault(); const { clientX, clientY } = getPosition(event); document.documentElement.style.removeProperty("user-select"); noteElement.classList.remove(NOTE_MOVING_CLASS); maskNoteElement.classList.remove(NOTE_MASK_MOVING_CLASS); maskPageElement.classList.remove(PAGE_MASK_ACTIVE_CLASS); maskNoteElement.classList.remove(noteElement.dataset.color); const headerElement = noteElement.querySelector("header"); headerElement.ontouchmove = document.documentElement.onmousemove = null; let currentElement = anchorElement; let positionedElement; while (currentElement.parentElement && !positionedElement) { if (!FORBIDDEN_TAG_NAMES.includes(currentElement.tagName.toLowerCase())) { const currentElementStyle = getComputedStyle(currentElement); if (currentElementStyle.position != "static") { positionedElement = currentElement; } } currentElement = currentElement.parentElement; } if (!positionedElement) { positionedElement = document.documentElement; } const containerElement = noteElement.getRootNode().host; if (positionedElement == document.documentElement) { const firstMaskElement = document.querySelector("." + MASK_CLASS); firstMaskElement.parentElement.insertBefore(containerElement, firstMaskElement); } else { positionedElement.appendChild(containerElement); } const boundingRectPositionedElement = positionedElement.getBoundingClientRect(); const stylePositionedElement = window.getComputedStyle(positionedElement); const borderX = parseInt(stylePositionedElement.getPropertyValue("border-left-width")); const borderY = parseInt(stylePositionedElement.getPropertyValue("border-top-width")); noteElement.style.setProperty("position", "absolute"); noteElement.style.setProperty("left", (clientX - boundingRectPositionedElement.x - deltaX - borderX) + "px"); noteElement.style.setProperty("top", (clientY - boundingRectPositionedElement.y - deltaY - borderY) + "px"); }; const getPosition = function getPosition(event) { if (event.touches && event.touches.length) { const touch = event.touches[0]; return touch; } else { return event; } }; const onMouseUp = function onMouseUp(event) { if (highlightSelectionMode) { event.preventDefault(); highlightSelection(); onUpdate(false); } if (removeHighlightMode) { event.preventDefault(); let element = event.target, done; while (element && !done) { if (element.classList.contains(HIGHLIGHT_CLASS)) { document.querySelectorAll("." + HIGHLIGHT_CLASS + "[data-singlefile-highlight-id=" + JSON.stringify(element.dataset.singlefileHighlightId) + "]").forEach(highlightedElement => { resetHighlightedElement(highlightedElement); onUpdate(false); }); done = true; } element = element.parentElement; } } if (resizingNoteMode) { event.preventDefault(); resizingNoteMode = false; document.documentElement.style.removeProperty("user-select"); maskPageElement.classList.remove(PAGE_MASK_ACTIVE_CLASS); document.documentElement.ontouchmove = onTouchMove; document.documentElement.onmousemove = null; onUpdate(false); } if (movingNoteMode) { event.preventDefault(); anchorNote(movingNoteMode.event || event, selectedNote, movingNoteMode.deltaX, movingNoteMode.deltaY); movingNoteMode = null; document.documentElement.ontouchmove = onTouchMove; document.documentElement.onmousemove = null; onUpdate(false); } if ((cuttingMode || cuttingOuterMode) && cuttingPath) { event.preventDefault(); if (event.ctrlKey) { const element = cuttingPath[cuttingPathIndex]; element.classList.toggle(cuttingMode ? CUT_SELECTED_CLASS : CUT_OUTER_SELECTED_CLASS); } else { validateCutElement(event.shiftKey); } } if (collapseNoteTimeout) { clearTimeout(collapseNoteTimeout); collapseNoteTimeout = null; } }; const getShadowRoot = function getShadowRoot(element) { const chrome = window.chrome; if (element.openOrClosedShadowRoot) { return element.openOrClosedShadowRoot; } else if (chrome && chrome.dom && chrome.dom.openOrClosedShadowRoot) { try { return chrome.dom.openOrClosedShadowRoot(element); } catch (error) { return element.shadowRoot; } } else { return element.shadowRoot; } }; const maskNoteElement = getMaskElement("note-mask"); const maskPageElement = getMaskElement("page-mask", "single-file-page-mask"); let selectedNote, highlightSelectionMode, removeHighlightMode, resizingNoteMode, movingNoteMode, collapseNoteTimeout, cuttingMode, cuttingOuterMode; window.onresize = reflowNotes; window.onUpdate = () => {}; document.documentElement.onmouseup = document.documentElement.ontouchend = onMouseUp; processNode(document); reflowNotes(); document.querySelectorAll("single-file-note").forEach(noteElement => attachNoteListeners(noteElement)); })()</script>
<script type="text/javascript" src="/1.js"></script></body>
</html>