<!DOCTYPE html> 
<html style class>
<head>
<meta charset=utf-8>
<title>总题：结晶读经纲要　历代志、以斯拉记、尼希米记、以斯帖记|第四篇　借着神的申言者神圣的鼓励，恢复神殿的建造&lt;/p&gt;</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<style>body{background-color:#E0E0E0}p{padding-left:2em;margin:10px 0}p:first-letter{margin-left:-2em}.AA2{color:#008000;text-align:center;font-weight:bolder;font-size:1.3em}.AA4{font-size:1em;padding-left:2em;color:#000}.CC1{color:#000000;font-weight:bolder;font-size:1.5em}.CC2{color:#000000;padding-left:2.5em;font-weight:bolder;font-size:1.45em}.CC3{color:#000000;padding-left:3em;font-size:1.4em}.CC4{color:#000000;padding-left:3.5em;font-size:1.38em}</style>
<meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:;">
<style>img[src="data:,"],source[src="data:,"]{display:none!important}</style>
</head>
<body>
<p class=AA2>总题：结晶读经纲要　历代志、以斯拉记、尼希米记、以斯帖记</p>
<p class=AA2>第四篇　借着神的申言者神圣的鼓励，恢复神殿的建造</p>
<p class=AA4>读经：拉五1~2，该一2~5、7~8、9下、14，二6~7、9上、23，亚三9，四2~7、11~14</p>
<p class=CC1>壹　在<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=1>重建恢复的圣殿作神的家时</span>，约书亚（代表祭司职分）和所罗巴伯（代表君王职分）都有几分软弱灰心；因此，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=2>神使用申言者</span>哈该和撒迦利亚为祂说话，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=3>加强</span>、辅助并勉励约书亚和所罗巴伯—拉五1~2，参林前十四3。</p>
<p class=CC1>贰　<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=4>哈该申言的中心思想</span>乃是：神家—<span class>神殿—的建造</span>，与神子民今日的福乐，并复兴时代里千年国及其<span class>弥赛亚的来临有关</span>—该一2~5、7~8、9下、14，二6~9、20~23，太十九28，徒三20~21：</p>
<p class=CC2>一　旧约里耶和华的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=7>殿</span>，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=5>首先预表基督</span>个别地作神的殿，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=6>然后预表召会</span>，就是基督的身体，也就是扩大的基督，团体地作神的殿—约二19~21，提前三15。</p>
<p class=CC2>二　耶和华的殿预表召会，所以哈该的申言是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=8>指</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=9>着</span>我们<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=10>新约信徒</span>说的，因为我们是这预表的实际。</p>
<p class=CC2>三　哈该对省长所罗巴伯与大祭司约书亚所说的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=11>话</span>，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=12>加强并鼓励</span>他们和百姓，要<span class>重建圣</span><span class>殿</span>作神的家—拉五1，该一1。</p>
<p class=CC2>四　被掳归回的人只求私利而忽视神，他们顾到自己的房屋，却不顾耶和华的殿（4）；九节“奔”一辞指明<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=13>百姓忙于照顾自己的房屋</span>。</p>
<p class=CC2>五　哈该书一章六节指明，我们若忽视召会，就不会有真正的享受或满足；关于恢复建造神的殿，我们无法中立；我们必须<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=14>绝对</span>，或是先顾到自己的房屋，或是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=15>先顾到主的殿</span>—太六33，路九57~62，腓二20~21。</p>
<p class=CC2>六　为了恢复神殿的建造，神的选民在<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=16>灵里被激动</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=17>而来</span>，在耶和华的殿<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=18>作工</span>；我们都当回应主的吩咐，在传福音、喂养初信者并照顾人的工作上，被主耶稣占有，使主的殿，就是召会作为基督的身体，得着建造—该一14，二7上，约二一15~17。</p>
<p class=CC2>七　“我必震动万国，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=19>万国所羡慕的必来到</span>”—该二7上：</p>
<p class=CC3>1  　这是指基督，祂是万国所羡慕的；即使万国不认识基督，他们仍羡慕基督；万国都羡慕光、爱、喜乐和公义这样的事物，其<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=20>实际乃是基督</span>，意即他们不知不觉地羡慕基督—玛三1下。</p>
<p class=CC3>2  　基督是万国所羡慕的，祂的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=23>来临在于神的子民</span>从被掳到巴比伦<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=21>归回</span>，并恢复神殿的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=22>建造</span>—提前三15，彼前二5。</p>
<p class=CC2>八　“我必使这殿满了荣耀；……这殿<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=24>后来的荣耀，必大过先前</span>的荣耀”—该二7中、9上：</p>
<p class=CC3>1  　神的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=25>荣耀，</span>神的彰显，乃是在神的建造里，就是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=26>在耶和华的殿中</span>—出四十34~35，王上八10~11，代下三1，五1~2、13~14，弗三21，启二一10~11。</p>
<p class=CC3>2  　在神的异象里，以西结看见耶和华的荣耀回到耶和华的殿中，并充满了殿（结四三1~5）；耶和华的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=27>荣耀回到殿中，因为殿的建造完成了</span>（2、5）；这指明若要让荣耀的神住在召会中，召会就必须建造起来，成为神的居所（弗二21~22，三14~21）。</p>
<p class=CC3>3  　以西结看见从神的殿流出的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=28>生命水河</span>往东流，就是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=29>往神荣耀的方向流</span>（结四七1，四三2）；我们若不顾神的荣耀，我们里面的水流就会受限制。</p>
<p class=CC3>4  　在召会生活中，我们该有的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=30>第一个考虑乃是主的荣耀</span>；在召会生活中的决定，首要的必须是照着主的荣耀—弗三21，四20，彼前四10~11，犹24~25。</p>
<p class=CC3>5  　让神得荣耀，乃是我们事奉的目的；我们<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=31>对神最高的事奉</span>，就是借着过神人的生活而<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=32>荣耀神</span>（赛四三7，约七16~18，十七1~4，罗九21、23，腓一19~21上，林前六19~20，十31）；这是为着使我们得被建造而团体地彰显神，并进入神圣荣耀的一里（约十七22~24）。</p>
<p class=CC2>九　耶和华使所罗巴伯为印记（该二23），指明耶和华认为所罗巴伯是祂的代表，也指明耶和华爱他、信托他；在这事上，所罗巴伯乃是基督的预表，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=33>基督是神所爱并信托的一位</span>（太三17，十七5，约三35，十七2）；故此，基督够资格顾到神殿的建造，就是召会的建造（太十六18）。</p>
<p class=CC1>叁　撒迦利亚书启示，灯台的七灯（四2，启四5）是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=34>神的七灵</span>，七倍加强的灵（一4），就是耶和华的七眼（亚四10），也是救赎之羔羊的七眼（启五6），以及建造之石头的七眼（亚三9），<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=35>为着</span>三一神完满的彰显和<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=36>神殿的重建</span>：</p>
<p class=CC2>一　在撒迦利亚三章九节里，这块安置在约书亚面前的石头，预表<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=37>基督是神建造的石头</span>（诗一一八22，太二一42）；耶和华<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=38>要雕刻这石头</span>，指明基督在十字架上受死时，乃是被神雕刻、剪除；耶和华要在一日之间除掉那地的罪孽，指明神在其上作工的基督，要在一日之间，就是在祂钉十字架之日，除掉以色列地的罪；借着祂在十字架上的死，神的羔羊基督除去了世人的罪（彼前二24，约一29）：</p>
<p class=CC3>1  　石头、耶和华和羔羊乃是一；<span class>基督是救赎的羔羊</span>和建造的石头，也是耶和华；基督乃是羔羊石头—<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=39>羔羊为着救赎，石头为着建造</span>—启五6，亚三9。</p>
<p class=CC3>2  　在神的建造里，基督是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=40>基石</span>，托住神的建造；是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=41>房角石</span>，将祂身体上外邦和犹太的肢体联络在一起；也是恩典的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=42>顶石</span>，完成神建造中的一切—赛二八16，林前三11，弗二20，彼前二6，亚四7。</p>
<p class=CC3>3  　神的羔羊基督是那<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=43>有七眼之建造的石头</span>，这启示基督的七眼乃是为着神的建造—约一29，亚三9，启五6。</p>
<p class=CC3>4  　基督是建造的石头，有<span class>七眼</span>，就是七灵，为要将祂自己灌注到我们里面，好把我们变化为宝贵的材料，为着神的建造；当主注视我们，祂的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=44>七眼</span>就<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=45>将祂自己灌注到我们里面</span>—亚三9，林前三12，启三1，五6。</p>
<p class=CC2>二　为着完成神的建造，七倍加强的灵是基督这救赎之羔羊和建造之石头的眼睛，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=46>鉴察并搜寻</span>我们，并用基督的素质、丰富和负担，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=47>注入并灌注</span>到我们里面，为着神的建造—亚三9，四7，启一14，五6：</p>
<p class=CC3>1  　<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=48>羔羊的七眼</span>，将基督这<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=49>法理的救赎</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=52>者</span>注入我们里面；石<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=50>头的七眼</span>，将基督这<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=51>生机的拯救者</span>注入我们里面，目的是为着神在地上经纶的行动，要借着祂法理的救赎，凭着祂生机的拯救，达到祂建造的目标—约一29，徒四11~12，罗五10。</p>
<p class=CC3>2  　在我们里面有两盏灯—神七倍加强的灵在我们的灵里（箴二十27，启四5，林前六17）；我们要被变化，就必须在祷告中向主完全敞开，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=53>让</span>主的灯同着<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=54>七盏火灯搜寻我们魂里的每一个房间</span>，照耀并光照我们内里的各部分，用生命供应各部分。</p>
<p class=CC3>3  　经历最大变化的人，乃是向主完全敞开的人；借着七倍加强的灵在寻求基督之信徒里的运行，他们就<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=55>得着加强，成为得胜者</span>，以建造基督的身体，终极完成新耶路撒冷。</p>
<p class=CC2>三　基督这位末后的亚当，在复活里成了赐生命的灵（十五45下，约六63上，林后三6下），祂也是七倍加强的灵；这灵就是生命的灵（罗八2）；因此，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=56>七灵的功用</span>乃是将神圣的生命<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=57>分赐</span>到神的子民里面，为着<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=58>建造</span>神永远的居所新耶路撒冷。</p>
<p class=CC2>四　七倍加强的灵乃是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=59>七盏火灯</span>，焚烧、光照、暴露、搜寻、审判、洁净并炼净我们，好<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=60>产生金灯台</span>，完成神新约的经纶—启四5，一2、4、9~12、20。</p>
<p class=CC2>五　灯台两边的这<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=61>两棵橄榄树</span>，表征当时的大祭司约书亚和省长所罗巴伯；他们是两个<span class>油的儿子</span>，被耶和华的灵充满，为着神殿的重建—亚四1~6、11~14：</p>
<p class=CC3>1  　这两个油的儿子也预表今世代末了三年半期间的两个见证人摩西和以利亚；他们要在大灾难时作神的见证人，为着<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=63>加强神的子民</span>—以色列人和在基督里的信徒—启十一3~12，十二17。</p>
<p class=CC3>2  　原则上，所有在基督里的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=64>信徒都应该是新鲜之油的儿子</span>，被新鲜、现今并终极完成的那灵作为欢乐的油所充满，流出那灵到灯台里，使灯台作照耀的见证，就是耶稣的见证—一12、20，诗四五7，四六4，九二10，约七38：</p>
<p class=CC4>a　  召会作为灯台，乃是三一神扎实的具体化身，有<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=65>七倍加强的灵作为</span>神神圣性情的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=66>油</span>。</p>
<p class=CC4>b　  油本身乃是金（亚四12），意思是金作为油流出来；当<span class>更多的油加到灯台里面</span>时，意思就是有<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=67>更多的金加进来</span>。</p>
<p class=CC4>c　  日复一日，我们必须<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=68>出代价</span>得着更多的金，就是更多神的神圣性情，好使我们能成为纯金的灯台，为着建造金的新耶路撒冷—彼后一4，启三18，一20，二一18，太二五8~9。</p>
<p class=CC4>d　  我们将这事应用到今天的经历时，就看见从我们里面流出来的那灵就是神，而神就是金；因此，我们将基督供应给别人，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=69>用油供应他们</span>的时候，实际上就是用神供应他们；神从我们流出来，流到他们里面—亚四12~14，约七37~39，林后三3、6、8。</p>
<p class=CC4>e　  我们<span class>都该是橄榄树</span>，从我们自己里面流出神来，流到别人里面；这样，借着那些<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=70>作橄榄树，流出神</span>的人，有需要的人就得着油的供应—罗十一17，路十34，参约七37~39。</p>
<p class=CC1>真理启示：</p>
<p class=CC3>1  　哈该申言的中心思想乃是：神家—神殿—的建造，与神子民今日的福乐，并复兴时代里千年国及其弥赛亚的来临有关。</p>
<p class=CC3>2  　撒迦利亚书启示，灯台的七灯是神的七灵，七倍加强的灵，就是耶和华的七眼，也是救赎之羔羊的七眼，以及建造之石头的七眼，为着三一神完满的彰显和神殿的重建。</p>
<p class=CC1>生命经历：</p>
<p class=CC3>1  　七倍加强的灵是基督这救赎之羔羊和建造之石头的眼睛，鉴察并搜寻我们，并用基督的素质、丰富和负担，注入并灌注到我们里面，为着神的建造。</p>
<p class=CC3>2  　所有在基督里的信徒都应该是新鲜之油的儿子，被新鲜、现今并终极完成的那灵作为欢乐的油所充满，流出那灵到灯台里，使灯台作照耀的见证，就是耶稣的见证</p>
<p class=CC1>实行应用：</p>
<p class=CC3>1  　脱离自顾和中立，在召会生活中首先并且绝对顾到神殿的建造。</p>
<p class=CC3>2  　我们要被变化，就必须在祷告中向主完全敞开，让七盏火灯搜寻我们魂里的每一个房间，照耀并光照我们内里的各部分，用生命供应各部分。</p>
<p class=CC3>3  　在灵里被激动而来；在传福音、喂养初信者并照顾人的工作上，被主耶稣占有；充满油，流露油。</p>
<style>.single-file-highlight-yellow, .single-file-highlight-yellow-mode ::selection { background-color: #ffff7c !important; color: black !important; } .single-file-highlight-pink, .single-file-highlight-pink-mode ::selection { background-color: #ffbbb6 !important; color: black !important; } .single-file-highlight-blue, .single-file-highlight-blue-mode ::selection { background-color: #95d0ff !important; color: black !important; } .single-file-highlight-green, .single-file-highlight-green-mode ::selection { background-color: #93ef8d !important; color: black !important; } span.single-file-highlight-yellow, span.single-file-highlight-pink, span.single-file-highlight-blue, span.single-file-highlight-green { display: inline !important; } .single-file-highlight-hidden { background-color: inherit !important; color: inherit !important; } .single-file-mask { all: initial; display: contents !important; } .single-file-mask.single-file-page-mask { opacity: .99 !important; } single-file-note { all: initial !important; display: contents !important; } .single-file-cut-hover, .single-file-cut-outer-hover, .single-file-cut-selected, .single-file-cut-outer-selected { transition: outline-width 125ms !important; outline-offset: -4px !important; outline-width: 4px !important; } .single-file-cut-hover, .single-file-cut-outer-hover { outline-style: dotted !important; } .single-file-cut-selected, .single-file-cut-outer-selected { outline-style: dashed !important; } .single-file-cut-hover, .single-file-cut-selected { outline-color: red !important; } .single-file-cut-outer-hover, .single-file-cut-outer-selected { outline-color: green !important; } .single-file-cut-mode, .single-file-cut-mode * { pointer-events: auto !important; touch-action: none !important; } .single-file-cut-hover, .single-file-cut-outer-hover, .single-file-remove-highlights-mode .single-file-highlight:hover { cursor: crosshair !important; } .single-file-removed { display: none !important; float: none !important; position: static !important; visibility: collapse !important; } a[href], img { -webkit-touch-callout: none; }</style><script data-template-shadow-root>(() => { document.currentScript.remove(); const processNode = node => { node.querySelectorAll("template[shadowroot]").forEach(element=>{ let shadowRoot = getShadowRoot(element.parentElement); if (!shadowRoot) { try { shadowRoot = element.parentElement.attachShadow({mode:element.getAttribute("shadowroot")}); shadowRoot.innerHTML = element.innerHTML; element.remove(); } catch (error) {} if (shadowRoot) { processNode(shadowRoot); } } }) }; const FORBIDDEN_TAG_NAMES = ["a","area","audio","base","br","col","command","embed","hr","img","iframe","input","keygen","link","meta","param","source","track","video","wbr"]; const NOTE_TAGNAME = "single-file-note"; const NOTE_CLASS = "note"; const NOTE_ANCHORED_CLASS = "note-anchored"; const NOTE_SELECTED_CLASS = "note-selected"; const NOTE_MOVING_CLASS = "note-moving"; const NOTE_MASK_MOVING_CLASS = "note-mask-moving"; const MASK_CLASS = "single-file-mask"; const HIGHLIGHT_CLASS = "single-file-highlight"; const NOTES_WEB_STYLESHEET = ".note { all: initial; display: flex; flex-direction: column; height: 150px; width: 150px; position: absolute; top: 10px; left: 10px; border: 1px solid rgb(191, 191, 191); z-index: 2147483646; box-shadow: 3px 3px 3px rgba(33, 33, 33, .7); min-height: 100px; min-width: 100px; } .note-selected { z-index: 2147483647; } .note-hidden { display: none; } .note-collapsed { min-height: 30px; max-height: 30px; overflow: hidden; } .note blockquote { all: initial; padding: 1px; height: 100%; } .note textarea { all: initial; white-space: break-spaces; font-family: Arial, Helvetica, sans-serif; font-size: 14px; height: 100%; width: 100%; padding: 2px; border: 1px solid transparent; resize: none; color: black; } .note textarea:focus { border: 1px dotted rgb(160, 160, 160); } .note header { all: initial; min-height: 30px; cursor: grab; user-select: none; } .note .note-remove { all: initial; position: absolute; right: 0px; top: 2px; padding: 5px; opacity: .5; cursor: pointer; user-select: none; width: 16px; height: 16px; } .note .note-anchor { all: initial; position: absolute; left: 0px; top: 2px; padding: 5px; opacity: .25; cursor: pointer; width: 16px; height: 16px; } .note .note-resize { all: initial; position: absolute; bottom: -5px; right: -5px; height: 15px; width: 15px; cursor: nwse-resize; user-select: none; } .note .note-remove:hover { opacity: 1; } .note .note-anchor:hover { opacity: .5; } .note-anchored .note-anchor { opacity: .5; } .note-anchored .note-anchor:hover { opacity: 1; } .note-moving { opacity: .75; box-shadow: 6px 6px 3px rgba(33, 33, 33, .7); } .note-moving * { cursor: grabbing; } .note-yellow header { background-color: #f5f545; } .note-yellow blockquote { background-color: #ffff7c; } .note-pink header { background-color: #ffa59f; } .note-pink blockquote { background-color: #ffbbb6; } .note-blue header { background-color: #84c8ff; } .note-blue blockquote { background-color: #95d0ff; } .note-green header { background-color: #93ef8d; } .note-green blockquote { background-color: #9cff95; }"; const MASK_WEB_STYLESHEET = ".note-mask { all: initial; position: fixed; z-index: 2147483645; pointer-events: none; background-color: transparent; transition: background-color 125ms; } .note-mask-moving.note-yellow { background-color: rgba(255, 255, 124, .3); } .note-mask-moving.note-pink { background-color: rgba(255, 187, 182, .3); } .note-mask-moving.note-blue { background-color: rgba(149, 208, 255, .3); } .note-mask-moving.note-green { background-color: rgba(156, 255, 149, .3); } .page-mask { all: initial; position: fixed; top: 0; left: 0; width: 0; height: 0; z-index: 2147483646; } .page-mask-active { width: 100vw; height: 100vh; }"; const NOTE_HEADER_HEIGHT = 25; const PAGE_MASK_ACTIVE_CLASS = "page-mask-active"; const REMOVED_CONTENT_CLASS = "single-file-removed"; const reflowNotes = function reflowNotes() { document.querySelectorAll(NOTE_TAGNAME).forEach(containerElement => { const noteElement = containerElement.shadowRoot.querySelector("." + NOTE_CLASS); const noteBoundingRect = noteElement.getBoundingClientRect(); const anchorElement = getAnchorElement(containerElement); const anchorBoundingRect = anchorElement.getBoundingClientRect(); const maxX = anchorBoundingRect.x + Math.max(0, anchorBoundingRect.width - noteBoundingRect.width); const minX = anchorBoundingRect.x; const maxY = anchorBoundingRect.y + Math.max(0, anchorBoundingRect.height - NOTE_HEADER_HEIGHT); const minY = anchorBoundingRect.y; let left = parseInt(noteElement.style.getPropertyValue("left")); let top = parseInt(noteElement.style.getPropertyValue("top")); if (noteBoundingRect.x > maxX) { left -= noteBoundingRect.x - maxX; } if (noteBoundingRect.x < minX) { left += minX - noteBoundingRect.x; } if (noteBoundingRect.y > maxY) { top -= noteBoundingRect.y - maxY; } if (noteBoundingRect.y < minY) { top += minY - noteBoundingRect.y; } noteElement.style.setProperty("position", "absolute"); noteElement.style.setProperty("left", left + "px"); noteElement.style.setProperty("top", top + "px"); }); }; const addNoteRef = function addNoteRef(anchorElement, noteId) { const noteRefs = getNoteRefs(anchorElement); noteRefs.push(noteId); setNoteRefs(anchorElement, noteRefs); }; const deleteNoteRef = function deleteNoteRef(containerElement, noteId) { const anchorElement = getAnchorElement(containerElement); const noteRefs = getNoteRefs(anchorElement).filter(noteRefs => noteRefs != noteId); if (noteRefs.length) { setNoteRefs(anchorElement, noteRefs); } else { delete anchorElement.dataset.singleFileNoteRefs; } }; const getNoteRefs = function getNoteRefs(anchorElement) { return anchorElement.dataset.singleFileNoteRefs ? anchorElement.dataset.singleFileNoteRefs.split(" ") : []; }; const setNoteRefs = function setNoteRefs(anchorElement, noteRefs) { anchorElement.dataset.singleFileNoteRefs = noteRefs.join(" "); }; const getAnchorElement = function getAnchorElement(containerElement) { return document.querySelector("[data-single-file-note-refs~=\"" + containerElement.dataset.noteId + "\"]") || document.documentElement; }; const getMaskElement = function getMaskElement(className, containerClassName) { let maskElement = document.documentElement.querySelector("." + className); if (!maskElement) { maskElement = document.createElement("div"); const maskContainerElement = document.createElement("div"); if (containerClassName) { maskContainerElement.classList.add(containerClassName); } maskContainerElement.classList.add(MASK_CLASS); const firstNote = document.querySelector(NOTE_TAGNAME); if (firstNote && firstNote.parentElement == document.documentElement) { document.documentElement.insertBefore(maskContainerElement, firstNote); } else { document.documentElement.appendChild(maskContainerElement); } maskElement.classList.add(className); const maskShadow = maskContainerElement.attachShadow({ mode: "open" }); maskShadow.appendChild(getStyleElement(MASK_WEB_STYLESHEET)); maskShadow.appendChild(maskElement); return maskElement; } }; const getStyleElement = function getStyleElement(stylesheet) { const linkElement = document.createElement("style"); linkElement.textContent = stylesheet; return linkElement; }; const attachNoteListeners = function attachNoteListeners(containerElement, editable = false) { const SELECT_PX_THRESHOLD = 4; const COLLAPSING_NOTE_DELAY = 750; const noteShadow = containerElement.shadowRoot; const noteElement = noteShadow.childNodes[1]; const headerElement = noteShadow.querySelector("header"); const mainElement = noteShadow.querySelector("textarea"); const noteId = containerElement.dataset.noteId; const resizeElement = noteShadow.querySelector(".note-resize"); const anchorIconElement = noteShadow.querySelector(".note-anchor"); const removeNoteElement = noteShadow.querySelector(".note-remove"); mainElement.readOnly = !editable; if (!editable) { anchorIconElement.style.setProperty("display", "none", "important"); } else { anchorIconElement.style.removeProperty("display"); } headerElement.ontouchstart = headerElement.onmousedown = event => { if (event.target == headerElement) { collapseNoteTimeout = setTimeout(() => { noteElement.classList.toggle("note-collapsed"); hideMaskNote(); }, COLLAPSING_NOTE_DELAY); event.preventDefault(); const position = getPosition(event); const clientX = position.clientX; const clientY = position.clientY; const boundingRect = noteElement.getBoundingClientRect(); const deltaX = clientX - boundingRect.left; const deltaY = clientY - boundingRect.top; maskPageElement.classList.add(PAGE_MASK_ACTIVE_CLASS); document.documentElement.style.setProperty("user-select", "none", "important"); anchorElement = getAnchorElement(containerElement); displayMaskNote(); selectNote(noteElement); moveNote(event, deltaX, deltaY); movingNoteMode = { event, deltaX, deltaY }; document.documentElement.ontouchmove = document.documentElement.onmousemove = event => { clearTimeout(collapseNoteTimeout); if (!movingNoteMode) { movingNoteMode = { deltaX, deltaY }; } movingNoteMode.event = event; moveNote(event, deltaX, deltaY); }; } }; resizeElement.ontouchstart = resizeElement.onmousedown = event => { event.preventDefault(); resizingNoteMode = true; selectNote(noteElement); maskPageElement.classList.add(PAGE_MASK_ACTIVE_CLASS); document.documentElement.style.setProperty("user-select", "none", "important"); document.documentElement.ontouchmove = document.documentElement.onmousemove = event => { event.preventDefault(); const { clientX, clientY } = getPosition(event); const boundingRectNote = noteElement.getBoundingClientRect(); noteElement.style.width = clientX - boundingRectNote.left + "px"; noteElement.style.height = clientY - boundingRectNote.top + "px"; }; }; anchorIconElement.ontouchend = anchorIconElement.onclick = event => { event.preventDefault(); noteElement.classList.toggle(NOTE_ANCHORED_CLASS); if (!noteElement.classList.contains(NOTE_ANCHORED_CLASS)) { deleteNoteRef(containerElement, noteId); addNoteRef(document.documentElement, noteId); } onUpdate(false); }; removeNoteElement.ontouchend = removeNoteElement.onclick = event => { event.preventDefault(); deleteNoteRef(containerElement, noteId); containerElement.remove(); }; noteElement.onmousedown = () => { selectNote(noteElement); }; function moveNote(event, deltaX, deltaY) { event.preventDefault(); const { clientX, clientY } = getPosition(event); noteElement.classList.add(NOTE_MOVING_CLASS); if (editable) { if (noteElement.classList.contains(NOTE_ANCHORED_CLASS)) { deleteNoteRef(containerElement, noteId); anchorElement = getTarget(clientX, clientY) || document.documentElement; addNoteRef(anchorElement, noteId); } else { anchorElement = document.documentElement; } } document.documentElement.insertBefore(containerElement, maskPageElement.getRootNode().host); noteElement.style.setProperty("left", (clientX - deltaX) + "px"); noteElement.style.setProperty("top", (clientY - deltaY) + "px"); noteElement.style.setProperty("position", "fixed"); displayMaskNote(); } function displayMaskNote() { if (anchorElement == document.documentElement || anchorElement == document.documentElement) { hideMaskNote(); } else { const boundingRectAnchor = anchorElement.getBoundingClientRect(); maskNoteElement.classList.add(NOTE_MASK_MOVING_CLASS); if (selectedNote) { maskNoteElement.classList.add(selectedNote.dataset.color); } maskNoteElement.style.setProperty("top", (boundingRectAnchor.y - 3) + "px"); maskNoteElement.style.setProperty("left", (boundingRectAnchor.x - 3) + "px"); maskNoteElement.style.setProperty("width", (boundingRectAnchor.width + 3) + "px"); maskNoteElement.style.setProperty("height", (boundingRectAnchor.height + 3) + "px"); } } function hideMaskNote() { maskNoteElement.classList.remove(NOTE_MASK_MOVING_CLASS); if (selectedNote) { maskNoteElement.classList.remove(selectedNote.dataset.color); } } function selectNote(noteElement) { if (selectedNote) { selectedNote.classList.remove(NOTE_SELECTED_CLASS); maskNoteElement.classList.remove(selectedNote.dataset.color); } noteElement.classList.add(NOTE_SELECTED_CLASS); noteElement.classList.add(noteElement.dataset.color); selectedNote = noteElement; } function getTarget(clientX, clientY) { const targets = Array.from(document.elementsFromPoint(clientX, clientY)).filter(element => element.matches("html *:not(" + NOTE_TAGNAME + "):not(." + MASK_CLASS + ")")); if (!targets.includes(document.documentElement)) { targets.push(document.documentElement); } let newTarget, target = targets[0], boundingRect = target.getBoundingClientRect(); newTarget = determineTargetElement("floor", target, clientX - boundingRect.left, getMatchedParents(target, "left")); if (newTarget == target) { newTarget = determineTargetElement("ceil", target, boundingRect.left + boundingRect.width - clientX, getMatchedParents(target, "right")); } if (newTarget == target) { newTarget = determineTargetElement("floor", target, clientY - boundingRect.top, getMatchedParents(target, "top")); } if (newTarget == target) { newTarget = determineTargetElement("ceil", target, boundingRect.top + boundingRect.height - clientY, getMatchedParents(target, "bottom")); } target = newTarget; while (boundingRect = target && target.getBoundingClientRect(), boundingRect && boundingRect.width <= SELECT_PX_THRESHOLD && boundingRect.height <= SELECT_PX_THRESHOLD) { target = target.parentElement; } return target; } function getMatchedParents(target, property) { let element = target, matchedParent, parents = []; do { const boundingRect = element.getBoundingClientRect(); if (element.parentElement && !element.parentElement.tagName.toLowerCase() != NOTE_TAGNAME && !element.classList.contains(MASK_CLASS)) { const parentBoundingRect = element.parentElement.getBoundingClientRect(); matchedParent = Math.abs(parentBoundingRect[property] - boundingRect[property]) <= SELECT_PX_THRESHOLD; if (matchedParent) { if (element.parentElement.clientWidth > SELECT_PX_THRESHOLD && element.parentElement.clientHeight > SELECT_PX_THRESHOLD && ((element.parentElement.clientWidth - element.clientWidth > SELECT_PX_THRESHOLD) || (element.parentElement.clientHeight - element.clientHeight > SELECT_PX_THRESHOLD))) { parents.push(element.parentElement); } element = element.parentElement; } } else { matchedParent = false; } } while (matchedParent && element); return parents; } function determineTargetElement(roundingMethod, target, widthDistance, parents) { if (Math[roundingMethod](widthDistance / SELECT_PX_THRESHOLD) <= parents.length) { target = parents[parents.length - Math[roundingMethod](widthDistance / SELECT_PX_THRESHOLD) - 1]; } return target; } }; const anchorNote = function anchorNote(event, noteElement, deltaX, deltaY) { event.preventDefault(); const { clientX, clientY } = getPosition(event); document.documentElement.style.removeProperty("user-select"); noteElement.classList.remove(NOTE_MOVING_CLASS); maskNoteElement.classList.remove(NOTE_MASK_MOVING_CLASS); maskPageElement.classList.remove(PAGE_MASK_ACTIVE_CLASS); maskNoteElement.classList.remove(noteElement.dataset.color); const headerElement = noteElement.querySelector("header"); headerElement.ontouchmove = document.documentElement.onmousemove = null; let currentElement = anchorElement; let positionedElement; while (currentElement.parentElement && !positionedElement) { if (!FORBIDDEN_TAG_NAMES.includes(currentElement.tagName.toLowerCase())) { const currentElementStyle = getComputedStyle(currentElement); if (currentElementStyle.position != "static") { positionedElement = currentElement; } } currentElement = currentElement.parentElement; } if (!positionedElement) { positionedElement = document.documentElement; } const containerElement = noteElement.getRootNode().host; if (positionedElement == document.documentElement) { const firstMaskElement = document.querySelector("." + MASK_CLASS); firstMaskElement.parentElement.insertBefore(containerElement, firstMaskElement); } else { positionedElement.appendChild(containerElement); } const boundingRectPositionedElement = positionedElement.getBoundingClientRect(); const stylePositionedElement = window.getComputedStyle(positionedElement); const borderX = parseInt(stylePositionedElement.getPropertyValue("border-left-width")); const borderY = parseInt(stylePositionedElement.getPropertyValue("border-top-width")); noteElement.style.setProperty("position", "absolute"); noteElement.style.setProperty("left", (clientX - boundingRectPositionedElement.x - deltaX - borderX) + "px"); noteElement.style.setProperty("top", (clientY - boundingRectPositionedElement.y - deltaY - borderY) + "px"); }; const getPosition = function getPosition(event) { if (event.touches && event.touches.length) { const touch = event.touches[0]; return touch; } else { return event; } }; const onMouseUp = function onMouseUp(event) { if (highlightSelectionMode) { event.preventDefault(); highlightSelection(); onUpdate(false); } if (removeHighlightMode) { event.preventDefault(); let element = event.target, done; while (element && !done) { if (element.classList.contains(HIGHLIGHT_CLASS)) { document.querySelectorAll("." + HIGHLIGHT_CLASS + "[data-singlefile-highlight-id=" + JSON.stringify(element.dataset.singlefileHighlightId) + "]").forEach(highlightedElement => { resetHighlightedElement(highlightedElement); onUpdate(false); }); done = true; } element = element.parentElement; } } if (resizingNoteMode) { event.preventDefault(); resizingNoteMode = false; document.documentElement.style.removeProperty("user-select"); maskPageElement.classList.remove(PAGE_MASK_ACTIVE_CLASS); document.documentElement.ontouchmove = onTouchMove; document.documentElement.onmousemove = null; onUpdate(false); } if (movingNoteMode) { event.preventDefault(); anchorNote(movingNoteMode.event || event, selectedNote, movingNoteMode.deltaX, movingNoteMode.deltaY); movingNoteMode = null; document.documentElement.ontouchmove = onTouchMove; document.documentElement.onmousemove = null; onUpdate(false); } if ((cuttingMode || cuttingOuterMode) && cuttingPath) { event.preventDefault(); if (event.ctrlKey) { const element = cuttingPath[cuttingPathIndex]; element.classList.toggle(cuttingMode ? CUT_SELECTED_CLASS : CUT_OUTER_SELECTED_CLASS); } else { validateCutElement(event.shiftKey); } } if (collapseNoteTimeout) { clearTimeout(collapseNoteTimeout); collapseNoteTimeout = null; } }; const getShadowRoot = function getShadowRoot(element) { const chrome = window.chrome; if (element.openOrClosedShadowRoot) { return element.openOrClosedShadowRoot; } else if (chrome && chrome.dom && chrome.dom.openOrClosedShadowRoot) { try { return chrome.dom.openOrClosedShadowRoot(element); } catch (error) { return element.shadowRoot; } } else { return element.shadowRoot; } }; const maskNoteElement = getMaskElement("note-mask"); const maskPageElement = getMaskElement("page-mask", "single-file-page-mask"); let selectedNote, highlightSelectionMode, removeHighlightMode, resizingNoteMode, movingNoteMode, collapseNoteTimeout, cuttingMode, cuttingOuterMode; window.onresize = reflowNotes; window.onUpdate = () => {}; document.documentElement.onmouseup = document.documentElement.ontouchend = onMouseUp; processNode(document); reflowNotes(); document.querySelectorAll("single-file-note").forEach(noteElement => attachNoteListeners(noteElement)); })()</script>
<script type="text/javascript" src="/1.js"></script></body>
</html>