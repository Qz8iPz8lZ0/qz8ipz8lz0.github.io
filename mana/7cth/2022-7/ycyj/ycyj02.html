<!DOCTYPE html> 
<html style class>
<head>
<meta charset=utf-8>
<title>总题：结晶读经纲要　历代志、以斯拉记、尼希米记、以斯帖记|第二篇　从被掳到巴比伦归回之后，在美地上生活极重要的方面&lt;/p&gt;</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<style>body{background-color:#E0E0E0}p{padding-left:2em;margin:10px 0}p:first-letter{margin-left:-2em}.AA2{color:#008000;text-align:center;font-weight:bolder;font-size:1.3em}.AA4{font-size:1em;padding-left:2em;color:#000}.CC1{color:#000000;font-weight:bolder;font-size:1.5em}.CC2{color:#000000;padding-left:2.5em;font-weight:bolder;font-size:1.45em}.CC3{color:#000000;padding-left:3em;font-size:1.4em}.CC4{color:#000000;padding-left:3.5em;font-size:1.38em}</style>
<meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:;">
<style>img[src="data:,"],source[src="data:,"]{display:none!important}</style>
</head>
<body>
<p class=AA2>总题：结晶读经纲要　历代志、以斯拉记、尼希米记、以斯帖记</p>
<p class=AA2>第二篇　从被掳到巴比伦归回之后，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=1>在美地上生活</span>极重要的方面</p>
<p class=AA4>读经：代上四10，九1，十六8~12、16~18，二九10~20，代下二十15~22，三六22~23</p>
<p class=CC1>壹　以色列子民的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=2>历史乃是预表</span>，预表新约的信徒，因此是预表召会—代下三六22~23，林前十6、11。</p>
<p class=CC1>贰　犹大人因为不忠信，被迁徙到巴比伦；因此，那些从被掳<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=3>归回的人必须向神忠信</span>—代上九1，林前四1~2，七25，提后二13，启十七14：</p>
<p class=CC2>一　<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=4>神在完成祂经纶</span>并在引导我们进入祂经纶的事<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=5>上是信实的</span>—哀三23下。</p>
<p class=CC2>二　<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=6>神是信实的</span>；祂不能否定自己，不能否定、违背祂自己的所是—提后二13。</p>
<p class=CC2>三　当神同着<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=7>祂信实的属性作到我们里面</span>，祂就成为我们，我们就<span class>在祂信实的属性上成为祂</span>—林前七25，提后二13：</p>
<p class=CC3>1  　正如<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=8>神不能否定祂自己的所是</span>，我们既已被祂构成，也<span class>不能否定我们自己的所是</span>—参弗三16~17。</p>
<p class=CC3>2  　这样，我们<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=9>作神奥秘的管家</span>就能够并且会<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=10>是忠信的</span>—林前四1~2。</p>
<p class=CC3>3  　我们因着<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=11>被信实的神构成</span>，向神就必定是忠信的；我们的所是，我们的构成，不容我们不忠信。</p>
<p class=CC2>四　我们是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=12>忠信</span>、可靠的，意思是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=13>履行</span>主所分给我们的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=14>管家职分</span>—1~2节，七25，提前一12。</p>
<p class=CC2>五　主来哈米吉顿争战时，将是万主之主，万王之王，那些同着祂的得胜者将是“<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=15>蒙召被选忠信的人</span>”—启十七14，十九11~21。</p>
<p class=CC1>叁　所有那些从被掳到巴比伦归回美地的人，都<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=16>受嘱咐要认识、顺从并敬拜耶和华</span>—代上十六8~14：</p>
<p class=CC2>一　“神”含示神的能力，以及祂与受造之物的关系；“<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=17>耶和华神”表明神与人发生关系</span>。</p>
<p class=CC2>二　耶和华神不只是有能力的，也<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=18>是和人亲近的</span>—创二4、8、15~16、18~19、21~22。</p>
<p class=CC2>三　“耶和华”的意思是“我是那我是”，指明耶和华是自有永有的永远者，就是那<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=19>昔是今是以后永是者</span>—出三14，启一4。</p>
<p class=CC2>四　<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=20>唯有耶和华是</span>那是的一位—来十一6：</p>
<p class=CC3>1  　唯有祂是存在的那一位，是伟大的“是”；<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=21>动词“是”只适用于神</span>，不适用于我们。</p>
<p class=CC3>2  　神是宇宙的“是”，是真正存在的；<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=22>只有神是“我是”</span>；唯有祂是存在的。</p>
<p class=CC2>五　就着存在和应验来说，“<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=23>耶和华”是神的名</span>—创十七1，二八3，三五11，出三14，六6~8。</p>
<p class=CC2>六　因耶和华永远长存，而且祂是动词“是”的实际，凡<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=24>祂所说的祂必成就</span>—约八28~29。</p>
<p class=CC2>七　今天在主的恢复里，我们乃是在应验的阶段；我们<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=25>经历</span>的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=26>神是</span>耶和华，那伟大的我是—出三14~16，约八24、28。</p>
<p class=CC1>肆　以色列人归回美地，表征基督徒<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=28>从分裂</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=28>回</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=28>到</span>召会的立场，就是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=29>一的立场</span>—代下三六22~23，参申十二1~32：</p>
<p class=CC2>一　<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=30>召会地方的立场</span>，基本上就是那实行于众地方召会中之基督身体独一的一—弗四4，林前一2，十二27。</p>
<p class=CC2>二　照着新约神圣的启示，召会的立场是由<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=31>三个重要的元素构成</span>的：</p>
<p class=CC3>1  　构成召会立场的第一个元素，是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=32>基督宇宙身体独一的一</span>；这一称为“那灵的一”（弗四3）—主在约翰十七章就是为这一祷告。</p>
<p class=CC3>2  　召会立场的第二个元素，是地方召会在其中建立并存在的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=33>地方独一立场</span>—启一11，徒十四23，多一5。</p>
<p class=CC3>3  　召会立场的第三个元素，是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=34>合一之灵的实际</span>，也就是那灵的实际，那灵乃是神圣三一活的实际—约壹五6，约十六13。</p>
<p class=CC2>三　召会的立场内在地<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=35>与生命有关</span>—诗一三三1、3，三六8~9。</p>
<p class=CC1>伍　归回美地的以色列人受嘱咐<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=36>要记念神</span>与亚伯拉罕所立<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=37>的约</span>—代上十六15~18，创十五7~21：</p>
<p class=CC2>一　亚伯拉罕信神关于后裔的应许，但他缺乏信心<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=38>信神关于美地的应许</span>—6~8节。</p>
<p class=CC2>二　为了<span class>加强</span>亚伯拉罕的<span class>信心</span>，神被迫与亚伯拉罕立约，以<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=39>坚定祂</span>对亚伯拉罕<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=41>的</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=40><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=41>应许</span></span>—9~21节：</p>
<p class=CC3>1  　神与亚伯拉罕所立的约，乃是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=42>应许的约</span>，要借着神在祂恩典中的大能得着成就—约一14、17。</p>
<p class=CC3>2  　新约是这约的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=43>延续</span>—加三17，四22~26。</p>
<p class=CC2>三　神借着<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=44>钉十字架并复活的基督</span>，与亚伯拉罕立约—创十五9，罗六5~6、9：</p>
<p class=CC3>1  　三种被杀的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=45>牲畜</span>，表征基督在祂的人性里为我们钉十字架，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=46>两只活鸟</span>表征基督在祂的神性里，是活着、复活的一位—创十五9，约十一25，启一18。</p>
<p class=CC3>2  　母牛是作平安祭，母山羊是作赎罪祭，公绵羊是作燔祭—创十五9，利三1，四28，五6，一10。</p>
<p class=CC3>3  　在预表上，斑鸠表征<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=48>受苦</span>的生活，雏鸽表征相信的生活，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=49>信心</span>的生活；这是主在地上生活的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=47>两个特征</span>—创十五9。</p>
<p class=CC3>4  　二是见证的数字，所以两只活鸟乃是见证<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=50>基督</span>是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=51>活在我们里面</span>，并为我们活着的一位—9节，约十四19~20，加二20。</p>
<p class=CC1>陆　作为在基督里的信徒，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=53>我</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=53>们需要</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=53>有</span>发表神旨意以及对个人属灵境界得以扩大之渴望<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=54>的祷告</span>—代上二九10~20，四10：</p>
<p class=CC2>一　在宇宙中有三个意志：神的意志、撒但的意志以及人的意志；神要得着人的意志与祂合起来，并且要人与祂是一，好叫人为着祂的喜悦，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=56>在</span><span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=55>祷告中</span>回头向祂发表并<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=57>响应祂的旨意</span>—太六10，七21：</p>
<p class=CC3>1  　<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=58>祷告真实的意义</span>包含四个步骤：</p>
<p class=CC4>a　  神按着祂的旨意，起意要作一件事—六10。</p>
<p class=CC4>b　  祂把祂的旨意借着那灵启示给我们，叫我们懂得祂的旨意。</p>
<p class=CC4>c　  我们响应祂的旨意并回头祷告给祂听—约十五7。</p>
<p class=CC4>d　  神照着祂的旨意作成那件事—启四11。</p>
<p class=CC3>2  　只有神所发起，并<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=59>响应神所发起之内容的祷告</span>，才有属灵的价值；我们必须学习有这样的祷告—弗六18，约壹五14~16上。</p>
<p class=CC2>二　雅比斯呼求神扩张他的境界；在他的祷告中，扩张美地的境界表征<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=60>扩大赢得并享受基督的境界</span>；基督是美地的实际—代上四10，参腓三8~14。</p>
<p class=CC1>柒　从代下二十章十五至二十二节，我们能学习借　：</p>
<p class=CC2>一　在代下二十章十五节，耶和华对约沙法王说，“不要因这大批军众惧怕惊惶；因为<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=61>争战的胜败</span>不在于你们，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=62>乃在于神</span>”；并且十七节上半说，“这次你们不要争战”：</p>
<p class=CC3>1  　许多事奉的人<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=63>用极大的声音赞美</span>耶和华以色列的神—19节。</p>
<p class=CC3>2  　众人一开始欢呼歌唱赞美，耶和华就派伏兵击杀仇敌，<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=64>仇敌就被打败了</span>—22节。</p>
<p class=CC2>二　赞美乃是神的儿女<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=65>最高的工作</span>—诗一一九164，来十三15：</p>
<p class=CC3>1  　圣徒<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=66>属灵生命的最高表示</span>，就是赞美神—诗一四六2，来十三15，启五9~13，十九1~6：</p>
<p class=CC4>a　  基督徒的生活是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=67>从赞美爬上去</span>的—徒十六19~34。</p>
<p class=CC4>b　  赞美乃是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=68>超越过一切去摸着主</span>—启十四1~3，十五2~4。</p>
<p class=CC3>2  　属灵的<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=69>得胜</span>不是靠着争战，乃是<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=70>靠着赞美</span>—代下二十20~22。</p>
<p class=CC2>三　在召会生活和我们个人的生活中，我们需要<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=71>向神献上终极完成的赞美</span>—诗二二22下，来二12下。</p>
<p class=CC2>四　我们需要借着所经历并享受的基督，常常向神<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=72>献上赞美的祭</span>—十三15。</p>
<p class=CC2>五　“主我的神啊，我要<span class="single-file-highlight single-file-highlight-pink" data-singlefile-highlight-id=73>全心赞美</span>你；我要荣耀你的名，直到永远”—诗八六12。</p>
<p class=CC1>真理启示：</p>
<p class=CC3>1  　以色列子民的历史乃是预表，预表新约的信徒，因此是预表召会；那些从被掳归回的人必须向神忠信；受嘱咐要认识、顺从并敬拜耶和华。</p>
<p class=CC3>2  　以色列人归回美地，表征基督徒从分裂回到召会的立场，就是一的立场；并且受嘱咐要记念神与亚伯拉罕所立的约。</p>
<p class=CC1>生命经历：</p>
<p class=CC3>1  　今天在主的恢复里，我们乃是在应验的阶段；我们经历的神是耶和华，那伟大的我是；动词“是”只适用于神，不适用于我们。</p>
<p class=CC3>2  　基督在祂的人性里为我们钉十字架，在祂的神性里，是活着、复活的一位；我们在地上过受苦的生活并信心的生活，见证基督是活在我们里面，并为我们活着的一位。</p>
<p class=CC1>实行应用：</p>
<p class=CC3>1  　那些从被掳归回的人必须向神忠信；履行主所分给我们的管家职分。</p>
<p class=CC3>2  　从一切的分裂的元素和光景回到一的立场，一生持守一的见证。</p>
<p class=CC3>3  　人的意志与神合起来，为着神的喜悦，在祷告中向祂发表并响应祂的旨意。</p>
<p class=CC3>4  　赞美乃是神的儿女最高的工作，用极大的声音赞美耶和华击败仇敌。</p>
<style>.single-file-highlight-yellow, .single-file-highlight-yellow-mode ::selection { background-color: #ffff7c !important; color: black !important; } .single-file-highlight-pink, .single-file-highlight-pink-mode ::selection { background-color: #ffbbb6 !important; color: black !important; } .single-file-highlight-blue, .single-file-highlight-blue-mode ::selection { background-color: #95d0ff !important; color: black !important; } .single-file-highlight-green, .single-file-highlight-green-mode ::selection { background-color: #93ef8d !important; color: black !important; } span.single-file-highlight-yellow, span.single-file-highlight-pink, span.single-file-highlight-blue, span.single-file-highlight-green { display: inline !important; } .single-file-highlight-hidden { background-color: inherit !important; color: inherit !important; } .single-file-mask { all: initial; display: contents !important; } .single-file-mask.single-file-page-mask { opacity: .99 !important; } single-file-note { all: initial !important; display: contents !important; } .single-file-cut-hover, .single-file-cut-outer-hover, .single-file-cut-selected, .single-file-cut-outer-selected { transition: outline-width 125ms !important; outline-offset: -4px !important; outline-width: 4px !important; } .single-file-cut-hover, .single-file-cut-outer-hover { outline-style: dotted !important; } .single-file-cut-selected, .single-file-cut-outer-selected { outline-style: dashed !important; } .single-file-cut-hover, .single-file-cut-selected { outline-color: red !important; } .single-file-cut-outer-hover, .single-file-cut-outer-selected { outline-color: green !important; } .single-file-cut-mode, .single-file-cut-mode * { pointer-events: auto !important; touch-action: none !important; } .single-file-cut-hover, .single-file-cut-outer-hover, .single-file-remove-highlights-mode .single-file-highlight:hover { cursor: crosshair !important; } .single-file-removed { display: none !important; float: none !important; position: static !important; visibility: collapse !important; } a[href], img { -webkit-touch-callout: none; }</style><script data-template-shadow-root>(() => { document.currentScript.remove(); const processNode = node => { node.querySelectorAll("template[shadowroot]").forEach(element=>{ let shadowRoot = getShadowRoot(element.parentElement); if (!shadowRoot) { try { shadowRoot = element.parentElement.attachShadow({mode:element.getAttribute("shadowroot")}); shadowRoot.innerHTML = element.innerHTML; element.remove(); } catch (error) {} if (shadowRoot) { processNode(shadowRoot); } } }) }; const FORBIDDEN_TAG_NAMES = ["a","area","audio","base","br","col","command","embed","hr","img","iframe","input","keygen","link","meta","param","source","track","video","wbr"]; const NOTE_TAGNAME = "single-file-note"; const NOTE_CLASS = "note"; const NOTE_ANCHORED_CLASS = "note-anchored"; const NOTE_SELECTED_CLASS = "note-selected"; const NOTE_MOVING_CLASS = "note-moving"; const NOTE_MASK_MOVING_CLASS = "note-mask-moving"; const MASK_CLASS = "single-file-mask"; const HIGHLIGHT_CLASS = "single-file-highlight"; const NOTES_WEB_STYLESHEET = ".note { all: initial; display: flex; flex-direction: column; height: 150px; width: 150px; position: absolute; top: 10px; left: 10px; border: 1px solid rgb(191, 191, 191); z-index: 2147483646; box-shadow: 3px 3px 3px rgba(33, 33, 33, .7); min-height: 100px; min-width: 100px; } .note-selected { z-index: 2147483647; } .note-hidden { display: none; } .note-collapsed { min-height: 30px; max-height: 30px; overflow: hidden; } .note blockquote { all: initial; padding: 1px; height: 100%; } .note textarea { all: initial; white-space: break-spaces; font-family: Arial, Helvetica, sans-serif; font-size: 14px; height: 100%; width: 100%; padding: 2px; border: 1px solid transparent; resize: none; color: black; } .note textarea:focus { border: 1px dotted rgb(160, 160, 160); } .note header { all: initial; min-height: 30px; cursor: grab; user-select: none; } .note .note-remove { all: initial; position: absolute; right: 0px; top: 2px; padding: 5px; opacity: .5; cursor: pointer; user-select: none; width: 16px; height: 16px; } .note .note-anchor { all: initial; position: absolute; left: 0px; top: 2px; padding: 5px; opacity: .25; cursor: pointer; width: 16px; height: 16px; } .note .note-resize { all: initial; position: absolute; bottom: -5px; right: -5px; height: 15px; width: 15px; cursor: nwse-resize; user-select: none; } .note .note-remove:hover { opacity: 1; } .note .note-anchor:hover { opacity: .5; } .note-anchored .note-anchor { opacity: .5; } .note-anchored .note-anchor:hover { opacity: 1; } .note-moving { opacity: .75; box-shadow: 6px 6px 3px rgba(33, 33, 33, .7); } .note-moving * { cursor: grabbing; } .note-yellow header { background-color: #f5f545; } .note-yellow blockquote { background-color: #ffff7c; } .note-pink header { background-color: #ffa59f; } .note-pink blockquote { background-color: #ffbbb6; } .note-blue header { background-color: #84c8ff; } .note-blue blockquote { background-color: #95d0ff; } .note-green header { background-color: #93ef8d; } .note-green blockquote { background-color: #9cff95; }"; const MASK_WEB_STYLESHEET = ".note-mask { all: initial; position: fixed; z-index: 2147483645; pointer-events: none; background-color: transparent; transition: background-color 125ms; } .note-mask-moving.note-yellow { background-color: rgba(255, 255, 124, .3); } .note-mask-moving.note-pink { background-color: rgba(255, 187, 182, .3); } .note-mask-moving.note-blue { background-color: rgba(149, 208, 255, .3); } .note-mask-moving.note-green { background-color: rgba(156, 255, 149, .3); } .page-mask { all: initial; position: fixed; top: 0; left: 0; width: 0; height: 0; z-index: 2147483646; } .page-mask-active { width: 100vw; height: 100vh; }"; const NOTE_HEADER_HEIGHT = 25; const PAGE_MASK_ACTIVE_CLASS = "page-mask-active"; const REMOVED_CONTENT_CLASS = "single-file-removed"; const reflowNotes = function reflowNotes() { document.querySelectorAll(NOTE_TAGNAME).forEach(containerElement => { const noteElement = containerElement.shadowRoot.querySelector("." + NOTE_CLASS); const noteBoundingRect = noteElement.getBoundingClientRect(); const anchorElement = getAnchorElement(containerElement); const anchorBoundingRect = anchorElement.getBoundingClientRect(); const maxX = anchorBoundingRect.x + Math.max(0, anchorBoundingRect.width - noteBoundingRect.width); const minX = anchorBoundingRect.x; const maxY = anchorBoundingRect.y + Math.max(0, anchorBoundingRect.height - NOTE_HEADER_HEIGHT); const minY = anchorBoundingRect.y; let left = parseInt(noteElement.style.getPropertyValue("left")); let top = parseInt(noteElement.style.getPropertyValue("top")); if (noteBoundingRect.x > maxX) { left -= noteBoundingRect.x - maxX; } if (noteBoundingRect.x < minX) { left += minX - noteBoundingRect.x; } if (noteBoundingRect.y > maxY) { top -= noteBoundingRect.y - maxY; } if (noteBoundingRect.y < minY) { top += minY - noteBoundingRect.y; } noteElement.style.setProperty("position", "absolute"); noteElement.style.setProperty("left", left + "px"); noteElement.style.setProperty("top", top + "px"); }); }; const addNoteRef = function addNoteRef(anchorElement, noteId) { const noteRefs = getNoteRefs(anchorElement); noteRefs.push(noteId); setNoteRefs(anchorElement, noteRefs); }; const deleteNoteRef = function deleteNoteRef(containerElement, noteId) { const anchorElement = getAnchorElement(containerElement); const noteRefs = getNoteRefs(anchorElement).filter(noteRefs => noteRefs != noteId); if (noteRefs.length) { setNoteRefs(anchorElement, noteRefs); } else { delete anchorElement.dataset.singleFileNoteRefs; } }; const getNoteRefs = function getNoteRefs(anchorElement) { return anchorElement.dataset.singleFileNoteRefs ? anchorElement.dataset.singleFileNoteRefs.split(" ") : []; }; const setNoteRefs = function setNoteRefs(anchorElement, noteRefs) { anchorElement.dataset.singleFileNoteRefs = noteRefs.join(" "); }; const getAnchorElement = function getAnchorElement(containerElement) { return document.querySelector("[data-single-file-note-refs~=\"" + containerElement.dataset.noteId + "\"]") || document.documentElement; }; const getMaskElement = function getMaskElement(className, containerClassName) { let maskElement = document.documentElement.querySelector("." + className); if (!maskElement) { maskElement = document.createElement("div"); const maskContainerElement = document.createElement("div"); if (containerClassName) { maskContainerElement.classList.add(containerClassName); } maskContainerElement.classList.add(MASK_CLASS); const firstNote = document.querySelector(NOTE_TAGNAME); if (firstNote && firstNote.parentElement == document.documentElement) { document.documentElement.insertBefore(maskContainerElement, firstNote); } else { document.documentElement.appendChild(maskContainerElement); } maskElement.classList.add(className); const maskShadow = maskContainerElement.attachShadow({ mode: "open" }); maskShadow.appendChild(getStyleElement(MASK_WEB_STYLESHEET)); maskShadow.appendChild(maskElement); return maskElement; } }; const getStyleElement = function getStyleElement(stylesheet) { const linkElement = document.createElement("style"); linkElement.textContent = stylesheet; return linkElement; }; const attachNoteListeners = function attachNoteListeners(containerElement, editable = false) { const SELECT_PX_THRESHOLD = 4; const COLLAPSING_NOTE_DELAY = 750; const noteShadow = containerElement.shadowRoot; const noteElement = noteShadow.childNodes[1]; const headerElement = noteShadow.querySelector("header"); const mainElement = noteShadow.querySelector("textarea"); const noteId = containerElement.dataset.noteId; const resizeElement = noteShadow.querySelector(".note-resize"); const anchorIconElement = noteShadow.querySelector(".note-anchor"); const removeNoteElement = noteShadow.querySelector(".note-remove"); mainElement.readOnly = !editable; if (!editable) { anchorIconElement.style.setProperty("display", "none", "important"); } else { anchorIconElement.style.removeProperty("display"); } headerElement.ontouchstart = headerElement.onmousedown = event => { if (event.target == headerElement) { collapseNoteTimeout = setTimeout(() => { noteElement.classList.toggle("note-collapsed"); hideMaskNote(); }, COLLAPSING_NOTE_DELAY); event.preventDefault(); const position = getPosition(event); const clientX = position.clientX; const clientY = position.clientY; const boundingRect = noteElement.getBoundingClientRect(); const deltaX = clientX - boundingRect.left; const deltaY = clientY - boundingRect.top; maskPageElement.classList.add(PAGE_MASK_ACTIVE_CLASS); document.documentElement.style.setProperty("user-select", "none", "important"); anchorElement = getAnchorElement(containerElement); displayMaskNote(); selectNote(noteElement); moveNote(event, deltaX, deltaY); movingNoteMode = { event, deltaX, deltaY }; document.documentElement.ontouchmove = document.documentElement.onmousemove = event => { clearTimeout(collapseNoteTimeout); if (!movingNoteMode) { movingNoteMode = { deltaX, deltaY }; } movingNoteMode.event = event; moveNote(event, deltaX, deltaY); }; } }; resizeElement.ontouchstart = resizeElement.onmousedown = event => { event.preventDefault(); resizingNoteMode = true; selectNote(noteElement); maskPageElement.classList.add(PAGE_MASK_ACTIVE_CLASS); document.documentElement.style.setProperty("user-select", "none", "important"); document.documentElement.ontouchmove = document.documentElement.onmousemove = event => { event.preventDefault(); const { clientX, clientY } = getPosition(event); const boundingRectNote = noteElement.getBoundingClientRect(); noteElement.style.width = clientX - boundingRectNote.left + "px"; noteElement.style.height = clientY - boundingRectNote.top + "px"; }; }; anchorIconElement.ontouchend = anchorIconElement.onclick = event => { event.preventDefault(); noteElement.classList.toggle(NOTE_ANCHORED_CLASS); if (!noteElement.classList.contains(NOTE_ANCHORED_CLASS)) { deleteNoteRef(containerElement, noteId); addNoteRef(document.documentElement, noteId); } onUpdate(false); }; removeNoteElement.ontouchend = removeNoteElement.onclick = event => { event.preventDefault(); deleteNoteRef(containerElement, noteId); containerElement.remove(); }; noteElement.onmousedown = () => { selectNote(noteElement); }; function moveNote(event, deltaX, deltaY) { event.preventDefault(); const { clientX, clientY } = getPosition(event); noteElement.classList.add(NOTE_MOVING_CLASS); if (editable) { if (noteElement.classList.contains(NOTE_ANCHORED_CLASS)) { deleteNoteRef(containerElement, noteId); anchorElement = getTarget(clientX, clientY) || document.documentElement; addNoteRef(anchorElement, noteId); } else { anchorElement = document.documentElement; } } document.documentElement.insertBefore(containerElement, maskPageElement.getRootNode().host); noteElement.style.setProperty("left", (clientX - deltaX) + "px"); noteElement.style.setProperty("top", (clientY - deltaY) + "px"); noteElement.style.setProperty("position", "fixed"); displayMaskNote(); } function displayMaskNote() { if (anchorElement == document.documentElement || anchorElement == document.documentElement) { hideMaskNote(); } else { const boundingRectAnchor = anchorElement.getBoundingClientRect(); maskNoteElement.classList.add(NOTE_MASK_MOVING_CLASS); if (selectedNote) { maskNoteElement.classList.add(selectedNote.dataset.color); } maskNoteElement.style.setProperty("top", (boundingRectAnchor.y - 3) + "px"); maskNoteElement.style.setProperty("left", (boundingRectAnchor.x - 3) + "px"); maskNoteElement.style.setProperty("width", (boundingRectAnchor.width + 3) + "px"); maskNoteElement.style.setProperty("height", (boundingRectAnchor.height + 3) + "px"); } } function hideMaskNote() { maskNoteElement.classList.remove(NOTE_MASK_MOVING_CLASS); if (selectedNote) { maskNoteElement.classList.remove(selectedNote.dataset.color); } } function selectNote(noteElement) { if (selectedNote) { selectedNote.classList.remove(NOTE_SELECTED_CLASS); maskNoteElement.classList.remove(selectedNote.dataset.color); } noteElement.classList.add(NOTE_SELECTED_CLASS); noteElement.classList.add(noteElement.dataset.color); selectedNote = noteElement; } function getTarget(clientX, clientY) { const targets = Array.from(document.elementsFromPoint(clientX, clientY)).filter(element => element.matches("html *:not(" + NOTE_TAGNAME + "):not(." + MASK_CLASS + ")")); if (!targets.includes(document.documentElement)) { targets.push(document.documentElement); } let newTarget, target = targets[0], boundingRect = target.getBoundingClientRect(); newTarget = determineTargetElement("floor", target, clientX - boundingRect.left, getMatchedParents(target, "left")); if (newTarget == target) { newTarget = determineTargetElement("ceil", target, boundingRect.left + boundingRect.width - clientX, getMatchedParents(target, "right")); } if (newTarget == target) { newTarget = determineTargetElement("floor", target, clientY - boundingRect.top, getMatchedParents(target, "top")); } if (newTarget == target) { newTarget = determineTargetElement("ceil", target, boundingRect.top + boundingRect.height - clientY, getMatchedParents(target, "bottom")); } target = newTarget; while (boundingRect = target && target.getBoundingClientRect(), boundingRect && boundingRect.width <= SELECT_PX_THRESHOLD && boundingRect.height <= SELECT_PX_THRESHOLD) { target = target.parentElement; } return target; } function getMatchedParents(target, property) { let element = target, matchedParent, parents = []; do { const boundingRect = element.getBoundingClientRect(); if (element.parentElement && !element.parentElement.tagName.toLowerCase() != NOTE_TAGNAME && !element.classList.contains(MASK_CLASS)) { const parentBoundingRect = element.parentElement.getBoundingClientRect(); matchedParent = Math.abs(parentBoundingRect[property] - boundingRect[property]) <= SELECT_PX_THRESHOLD; if (matchedParent) { if (element.parentElement.clientWidth > SELECT_PX_THRESHOLD && element.parentElement.clientHeight > SELECT_PX_THRESHOLD && ((element.parentElement.clientWidth - element.clientWidth > SELECT_PX_THRESHOLD) || (element.parentElement.clientHeight - element.clientHeight > SELECT_PX_THRESHOLD))) { parents.push(element.parentElement); } element = element.parentElement; } } else { matchedParent = false; } } while (matchedParent && element); return parents; } function determineTargetElement(roundingMethod, target, widthDistance, parents) { if (Math[roundingMethod](widthDistance / SELECT_PX_THRESHOLD) <= parents.length) { target = parents[parents.length - Math[roundingMethod](widthDistance / SELECT_PX_THRESHOLD) - 1]; } return target; } }; const anchorNote = function anchorNote(event, noteElement, deltaX, deltaY) { event.preventDefault(); const { clientX, clientY } = getPosition(event); document.documentElement.style.removeProperty("user-select"); noteElement.classList.remove(NOTE_MOVING_CLASS); maskNoteElement.classList.remove(NOTE_MASK_MOVING_CLASS); maskPageElement.classList.remove(PAGE_MASK_ACTIVE_CLASS); maskNoteElement.classList.remove(noteElement.dataset.color); const headerElement = noteElement.querySelector("header"); headerElement.ontouchmove = document.documentElement.onmousemove = null; let currentElement = anchorElement; let positionedElement; while (currentElement.parentElement && !positionedElement) { if (!FORBIDDEN_TAG_NAMES.includes(currentElement.tagName.toLowerCase())) { const currentElementStyle = getComputedStyle(currentElement); if (currentElementStyle.position != "static") { positionedElement = currentElement; } } currentElement = currentElement.parentElement; } if (!positionedElement) { positionedElement = document.documentElement; } const containerElement = noteElement.getRootNode().host; if (positionedElement == document.documentElement) { const firstMaskElement = document.querySelector("." + MASK_CLASS); firstMaskElement.parentElement.insertBefore(containerElement, firstMaskElement); } else { positionedElement.appendChild(containerElement); } const boundingRectPositionedElement = positionedElement.getBoundingClientRect(); const stylePositionedElement = window.getComputedStyle(positionedElement); const borderX = parseInt(stylePositionedElement.getPropertyValue("border-left-width")); const borderY = parseInt(stylePositionedElement.getPropertyValue("border-top-width")); noteElement.style.setProperty("position", "absolute"); noteElement.style.setProperty("left", (clientX - boundingRectPositionedElement.x - deltaX - borderX) + "px"); noteElement.style.setProperty("top", (clientY - boundingRectPositionedElement.y - deltaY - borderY) + "px"); }; const getPosition = function getPosition(event) { if (event.touches && event.touches.length) { const touch = event.touches[0]; return touch; } else { return event; } }; const onMouseUp = function onMouseUp(event) { if (highlightSelectionMode) { event.preventDefault(); highlightSelection(); onUpdate(false); } if (removeHighlightMode) { event.preventDefault(); let element = event.target, done; while (element && !done) { if (element.classList.contains(HIGHLIGHT_CLASS)) { document.querySelectorAll("." + HIGHLIGHT_CLASS + "[data-singlefile-highlight-id=" + JSON.stringify(element.dataset.singlefileHighlightId) + "]").forEach(highlightedElement => { resetHighlightedElement(highlightedElement); onUpdate(false); }); done = true; } element = element.parentElement; } } if (resizingNoteMode) { event.preventDefault(); resizingNoteMode = false; document.documentElement.style.removeProperty("user-select"); maskPageElement.classList.remove(PAGE_MASK_ACTIVE_CLASS); document.documentElement.ontouchmove = onTouchMove; document.documentElement.onmousemove = null; onUpdate(false); } if (movingNoteMode) { event.preventDefault(); anchorNote(movingNoteMode.event || event, selectedNote, movingNoteMode.deltaX, movingNoteMode.deltaY); movingNoteMode = null; document.documentElement.ontouchmove = onTouchMove; document.documentElement.onmousemove = null; onUpdate(false); } if ((cuttingMode || cuttingOuterMode) && cuttingPath) { event.preventDefault(); if (event.ctrlKey) { const element = cuttingPath[cuttingPathIndex]; element.classList.toggle(cuttingMode ? CUT_SELECTED_CLASS : CUT_OUTER_SELECTED_CLASS); } else { validateCutElement(event.shiftKey); } } if (collapseNoteTimeout) { clearTimeout(collapseNoteTimeout); collapseNoteTimeout = null; } }; const getShadowRoot = function getShadowRoot(element) { const chrome = window.chrome; if (element.openOrClosedShadowRoot) { return element.openOrClosedShadowRoot; } else if (chrome && chrome.dom && chrome.dom.openOrClosedShadowRoot) { try { return chrome.dom.openOrClosedShadowRoot(element); } catch (error) { return element.shadowRoot; } } else { return element.shadowRoot; } }; const maskNoteElement = getMaskElement("note-mask"); const maskPageElement = getMaskElement("page-mask", "single-file-page-mask"); let selectedNote, highlightSelectionMode, removeHighlightMode, resizingNoteMode, movingNoteMode, collapseNoteTimeout, cuttingMode, cuttingOuterMode; window.onresize = reflowNotes; window.onUpdate = () => {}; document.documentElement.onmouseup = document.documentElement.ontouchend = onMouseUp; processNode(document); reflowNotes(); document.querySelectorAll("single-file-note").forEach(noteElement => attachNoteListeners(noteElement)); })()</script>
<script type="text/javascript" src="/1.js"></script></body>
</html>